<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">Convoyrama | Generador de Licencia</title>
  <meta name="description" content="Convoyrama">
  <link rel="stylesheet" href="../assets/style.css">
  <link rel="icon" href="../assets/images/favicon.png">
  <link rel="apple-touch-icon" href="../assets/images/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
  <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script>
  <style>
    header {padding: 15px; text-align: center; position: relative; z-index: 10; background: var(--accent-bg); border-bottom: 1px solid var(--border);}
    header p {font-size: 1.2em; text-shadow: none; font-family: Arial, sans-serif; font-weight: normal; margin: 10px 0; color: #fff;}
    nav {padding: 10px; text-align: center;}
    nav a, nav a:visited {text-decoration: none; margin: 0 15px; font-size: 1em; text-shadow: none; color: #fff;}
    nav a:hover {text-decoration: underline;}
    .contenedor {display: flex; gap: 20px; padding: 20px; align-items: flex-start; font-family: Arial, sans-serif;}
    .panel {flex: 1; max-width: 300px; font-size: 14px;}
    .panel h3 {margin: 10px 0 5px; font-size: 14px;}
    .input-group {margin: 6px 0;}
    .toggle-group {display: flex; gap: 10px; justify-content: space-between;}
    .toggle-group .toggle-item {flex: 1;}
    canvas {border: 1px solid #000; display: block; max-width: 100%; height: auto;}
    #preview {flex: 1; text-align: center;}
    button {padding: 6px 12px; font-size: 14px; margin-top: 10px; background: rgb(90,165,25); color: #fff; border: none; border-radius: 6px; cursor: pointer;}
    button:hover {opacity: 0.8;}
    .hidden {display: none;}
    #truckersmpStatus {font-size: 12px; color: #555; margin-top: 5px;}
    .valid {color: green;}
    .invalid {color: red;}
    #colorSlider {width: 80%; margin-top: 5px; vertical-align: middle;}
    #colorValue {display: inline-block; width: 15%; text-align: right; font-size: 14px; color: #555;}
  </style>
</head>

<body>
  <header>
    <nav>
      <a href="../index.html">Home</a>
      <a href="pc.html">Creador de Perfil</a>
      <a href="id.html" id="navLicense">Licencia</a>
    </nav>
    <p id="headerTitle">Generador de Licencia de Conductor</p>
  </header>

  <div class="contenedor">
    <div class="panel">
      <div class="input-group">
        <label for="languageToggle">Idioma / Language / LÃ­ngua:</label><br>
        <select id="languageToggle" style="width:100%">
          <option value="es">EspaÃ±ol</option>
          <option value="en">English</option>
          <option value="pt">PortuguÃªs</option>
        </select>
      </div>
      <div class="input-group">
        <label id="fontLabel">Fuente: <span id="fontName">Open Sans</span></label>
      </div>
      <div class="input-group">
        <label for="colorSlider" id="colorLabel">Tono del fondo:</label><br>
        <input type="range" id="colorSlider" min="0" max="360" value="0" style="width:80%">
        <span id="colorValue">0Â°</span>
      </div>
      <div class="input-group">
        <label for="nombre" id="nameLabel">Nombre:</label><br>
        <input type="text" id="nombre" placeholder="Nombre / Name / Nome" required>
      </div>
      <div class="input-group hidden" id="nicknameGroup">
        <label for="nickname" id="nicknameLabel">TAG Ã‰pico:</label><br>
        <select id="nickname" style="width:100%">
          <option value="">Seleccione un TAG</option>
          <option value="ReyDelLag">ReyDelLag</option>
          <option value="FrenadorEnCurva">FrenadorEnCurva</option>
          <option value="SeÃ±orDelLagazo">SeÃ±orDelLagazo</option>
          <option value="BocinaLoca">BocinaLoca</option>
          <option value="CargadorDeDeudas">CargadorDeDeudas</option>
          <option value="CamioneroDelApagÃ³n">CamioneroDelApagÃ³n</option>
          <option value="FugitivoDeLaRuta">FugitivoDeLaRuta</option>
          <option value="MaestroDelPing">MaestroDelPing</option>
          <option value="ReyDeLaCarretera">ReyDeLaCarretera</option>
          <option value="LocoDelVolante">LocoDelVolante</option>
          <option value="SobrevivienteDelBan">SobrevivienteDelBan</option>
          <option value="BanEvasor">BanEvasor</option>
          <option value="FrenazoEstelar">FrenazoEstelar</option>
          <option value="TerrorDeCalais">TerrorDeCalais</option>
          <option value="LagLegendario">LagLegendario</option>
          <option value="SobrevivienteDeKirkenes">SobrevivienteDeKirkenes</option>
          <option value="MaestroDelReckless">MaestroDelReckless</option>
          <option value="PingParalizante">PingParalizante</option>
          <option value="RutaSinRetorno">RutaSinRetorno</option>
          <option value="VolanteEndemoniado">VolanteEndemoniado</option>
          <option value="AsDelReporte">AsDelReporte</option>
          <option value="ReyDeDuisburg">ReyDeDuisburg</option>
          <option value="ReyDeCalais">ReyDeCalais</option>
          <option value="KaosEnLaRuta">KaosEnLaRuta</option>
          <option value="CarreteraPerdida">CarreteraPerdida</option>
          <option value="FrenadorDePÃ¡nico">FrenadorDePÃ¡nico</option>
          <option value="CargaConDrama">CargaConDrama</option>
        </select>
      </div>
      <div class="input-group hidden" id="titleToggleGroup">
        <label for="titleToggle" id="titleToggleLabel">Usar tÃ­tulo cÃ³mico:</label><br>
        <input type="checkbox" id="titleToggle">
      </div>
      <div class="input-group">
        <label for="foto" id="photoLabel">Foto (Opcional):</label><br>
        <input type="file" id="foto" accept="image/*">
      </div>
      <div class="input-group">
        <label for="pais" id="countryLabel">PaÃ­s:</label><br>
        <select id="pais" style="width:100%" required>
          <option value="">Seleccione un paÃ­s / Select a country / Selecione um paÃ­s</option>
          <option value="AO|ğŸ‡¦ğŸ‡´|Angola|Angola|Angola">ğŸ‡¦ğŸ‡´ Angola</option>
          <option value="AR|ğŸ‡¦ğŸ‡·|Argentina|Argentina|Argentina">ğŸ‡¦ğŸ‡· Argentina</option>
          <option value="BO|ğŸ‡§ğŸ‡´|Bolivia|Bolivia|BolÃ­via">ğŸ‡§ğŸ‡´ Bolivia</option>
          <option value="BR|ğŸ‡§ğŸ‡·|Brasil|Brazil|Brasil">ğŸ‡§ğŸ‡· Brasil</option>
          <option value="BZ|ğŸ‡§ğŸ‡¿|Belice|Belize|Belize">ğŸ‡§ğŸ‡¿ Belice</option>
          <option value="CA|ğŸ‡¨ğŸ‡¦|CanadÃ¡|Canada|CanadÃ¡">ğŸ‡¨ğŸ‡¦ CanadÃ¡</option>
          <option value="CL|ğŸ‡¨ğŸ‡±|Chile|Chile|Chile">ğŸ‡¨ğŸ‡± Chile</option>
          <option value="CN|ğŸ‡¨ğŸ‡³|China|China|China">ğŸ‡¨ğŸ‡³ China</option>
          <option value="CO|ğŸ‡¨ğŸ‡´|Colombia|Colombia|ColÃ´mbia">ğŸ‡¨ğŸ‡´ Colombia</option>
          <option value="CR|ğŸ‡¨ğŸ‡·|Costa Rica|Costa Rica|Costa Rica">ğŸ‡¨ğŸ‡· Costa Rica</option>
          <option value="CU|ğŸ‡¨ğŸ‡º|Cuba|Cuba|Cuba">ğŸ‡¨ğŸ‡º Cuba</option>
          <option value="DE|ğŸ‡©ğŸ‡ª|Alemania|Germany|Alemanha">ğŸ‡©ğŸ‡ª Alemania</option>
          <option value="DO|ğŸ‡©ğŸ‡´|RepÃºblica Dominicana|Dominican Republic|RepÃºblica Dominicana">ğŸ‡©ğŸ‡´ RepÃºblica Dominicana</option>
          <option value="EC|ğŸ‡ªğŸ‡¨|Ecuador|Ecuador|Equador">ğŸ‡ªğŸ‡¨ Ecuador</option>
          <option value="ES|ğŸ‡ªğŸ‡¸|EspaÃ±a|Spain|Espanha">ğŸ‡ªğŸ‡¸ EspaÃ±a</option>
          <option value="FR|ğŸ‡«ğŸ‡·|Francia|France|FranÃ§a">ğŸ‡«ğŸ‡· Francia</option>
          <option value="GB|ğŸ‡¬ğŸ‡§|Reino Unido|United Kingdom (England/Scotland)|Reino Unido">ğŸ‡¬ğŸ‡§ Reino Unido</option>
          <option value="GT|ğŸ‡¬ğŸ‡¹|Guatemala|Guatemala|Guatemala">ğŸ‡¬ğŸ‡¹ Guatemala</option>
          <option value="GY|ğŸ‡¬ğŸ‡¾|Guyana|Guyana|Guiana">ğŸ‡¬ğŸ‡¾ Guyana</option>
          <option value="HN|ğŸ‡­ğŸ‡³|Honduras|Honduras|Honduras">ğŸ‡­ğŸ‡³ Honduras</option>
          <option value="IE|ğŸ‡®ğŸ‡ª|Irlanda|Ireland|Irlanda">ğŸ‡®ğŸ‡ª Irlanda</option>
          <option value="IT|ğŸ‡®ğŸ‡¹|Italia|Italy|ItÃ¡lia">ğŸ‡®ğŸ‡¹ Italia</option>
          <option value="JM|ğŸ‡¯ğŸ‡²|Jamaica|Jamaica|Jamaica">ğŸ‡¯ğŸ‡² Jamaica</option>
          <option value="JP|ğŸ‡¯ğŸ‡µ|JapÃ³n|Japan|JapÃ£o">ğŸ‡¯ğŸ‡µ JapÃ³n</option>
          <option value="MX|ğŸ‡²ğŸ‡½|MÃ©xico|Mexico|MÃ©xico">ğŸ‡²ğŸ‡½ MÃ©xico</option>
          <option value="MZ|ğŸ‡²ğŸ‡¿|Mozambique|Mozambique|MoÃ§ambique">ğŸ‡²ğŸ‡¿ Mozambique</option>
          <option value="NI|ğŸ‡³ğŸ‡®|Nicaragua|Nicaragua|NicarÃ¡gua">ğŸ‡³ğŸ‡® Nicaragua</option>
          <option value="PA|ğŸ‡µğŸ‡¦|PanamÃ¡|Panama|PanamÃ¡">ğŸ‡µğŸ‡¦ PanamÃ¡</option>
          <option value="PE|ğŸ‡µğŸ‡ª|PerÃº|Peru|Peru">ğŸ‡µğŸ‡ª PerÃº</option>
          <option value="PI|ğŸ´â€â˜ ï¸|Pirata|Pirate|Pirata">ğŸ´â€â˜ ï¸ Pirata</option>
          <option value="PL|ğŸ‡µğŸ‡±|Polonia|Poland|PolÃ´nia">ğŸ‡µğŸ‡± Polonia</option>
          <option value="PT|ğŸ‡µğŸ‡¹|Portugal|Portugal|Portugal">ğŸ‡µğŸ‡¹ Portugal</option>
          <option value="PY|ğŸ‡µğŸ‡¾|Paraguay|Paraguay|Paraguai">ğŸ‡µğŸ‡¾ Paraguay</option>
          <option value="RO|ğŸ‡·ğŸ‡´|Rumania|Romania|RomÃªnia">ğŸ‡·ğŸ‡´ Rumania</option>
          <option value="RU|ğŸ‡·ğŸ‡º|Rusia|Russia|RÃºssia">ğŸ‡·ğŸ‡º Rusia</option>
          <option value="SR|ğŸ‡¸ğŸ‡·|Surinam|Suriname|Suriname">ğŸ‡¸ğŸ‡· Surinam</option>
          <option value="SV|ğŸ‡¸ğŸ‡»|El Salvador|El Salvador|El Salvador">ğŸ‡¸ğŸ‡» El Salvador</option>
          <option value="TR|ğŸ‡¹ğŸ‡·|TurquÃ­a|Turkey|Turquia">ğŸ‡¹ğŸ‡· TurquÃ­a</option>
          <option value="UA|ğŸ‡ºğŸ‡¦|Ucrania|Ukraine|UcrÃ¢nia">ğŸ‡ºğŸ‡¦ Ucrania</option>
          <option value="US|ğŸ‡ºğŸ‡¸|Estados Unidos|United States|Estados Unidos">ğŸ‡ºğŸ‡¸ Estados Unidos</option>
          <option value="UY|ğŸ‡ºğŸ‡¾|Uruguay|Uruguay|Uruguai" selected>ğŸ‡ºğŸ‡¾ Uruguay</option>
          <option value="VE|ğŸ‡»ğŸ‡ª|Venezuela|Venezuela|Venezuela">ğŸ‡»ğŸ‡ª Venezuela</option>
        </select>
      </div>
      <div class="input-group" id="empresaGroup">
        <label for="empresa" id="companyLabel">Empresa:</label><br>
        <select id="empresa" style="width:100%" onchange="updForm()">
          <option value="LS" selected>LS</option>
          <option value="CN">CN</option>
          <option value="TCS">TCS</option>
          <option value="Otro">Otra</option>
        </select>
      </div>
      <div class="input-group hidden" id="empresaLinkGroup">
        <label for="empresaLink" id="companyLinkLabel">Enlace Perfil Empresa en TMP:</label><br>
        <input type="text" id="empresaLink" placeholder="TruckersMP Company Profile Link" required>
      </div>
      <div class="input-group">
        <label for="truckersmpLink" id="truckersmpLinkLabel">Enlace Perfil en TMP:</label><br>
        <input type="text" id="truckersmpLink" placeholder="TruckersMP Profile Link" required>
        <div id="truckersmpStatus"></div>
      </div>
      <div class="input-group toggle-group">
        <div class="toggle-item">
          <label for="promodsToggle">ProMods:</label><br>
          <input type="checkbox" id="promodsToggle">
        </div>
        <div class="toggle-item">
          <label for="dbusworldToggle">DBUS:</label><br>
          <input type="checkbox" id="dbusworldToggle">
        </div>
      </div>
    </div>
    <div id="preview">
      <canvas id="canvas" width="800" height="500"></canvas>
      <br>
      <a id="descargar" download="driver_license.png">
        <button id="botonDescargar">Descargar Licencia</button>
      </a>
    </div>
  </div>

  <footer>
    <small>Â© LAG'S SPEED - CONVOYRAMA 2025 - versiÃ³n 1.8.5-testing</small>
  </footer>

  <script>
    function rTwemoji(e,s){return new Promise(r=>{const i=new Image;i.onload=()=>{r(i)};i.onerror=()=>{r(null)};i.src=twemoji.parse(e,{folder:'svg',ext:'.svg'}).match(/src="([^"]+)"/)[1];i.crossOrigin="anonymous"})}
    const cnv=document.getElementById("canvas"),ctx=cnv.getContext("2d"),cfg={color:"white",flagSize:80,photoX:45,photoY:80,labelX:100,colonX:130,textX:295,textY:334,qrX:573,qrY:101,flagX:625,flagY:206,font:"'Open Sans', Arial, sans-serif",defaultPhotoSize:192,qrSize:100,qrSpacing:10,promodsX:20,promodsY:334,dbusworldX:20,dbusworldY:394,logoWidth:67,logoHeight:50,vtcLogoHeight:80},vtcMap={"https://truckersmp.com/vtc/55250-andesvtc":"andes.png","https://truckersmp.com/vtc/55250":"andes.png","https://truckersmp.com/vtc/29591":"castores.jpg","https://truckersmp.com/vtc/81636":"chapu.jpeg","https://truckersmp.com/vtc/55439-destiny":"destiny.png","https://truckersmp.com/vtc/55439":"destiny.png","https://truckersmp.com/vtc/56572-lsavtc":"lsa.png","https://truckersmp.com/vtc/56572":"lsa.png","https://truckersmp.com/vtc/79357":"norte.png","https://truckersmp.com/vtc/34966-nova-era":"nova.png","https://truckersmp.com/vtc/34966":"nova.png","https://truckersmp.com/vtc/64312":"shipeados.png","https://truckersmp.com/vtc/65011":"tl.png","https://truckersmp.com/vtc/17910-transportesatr":"atr.png","https://truckersmp.com/vtc/17910":"atr.png"},trans={
    es:{pageTitle:"Convoyrama | Generador de Licencia",headerTitle:"Generador de Licencia de Conductor",navLicense:"Licencia",fontLabel:"Fuente: ",nameLabel:"Nombre:",nicknameLabel:"TAG Ã‰pico:",titleToggleLabel:"Usar tÃ­tulo cÃ³mico:",photoLabel:"Foto (Opcional):",countryLabel:"PaÃ­s:",companyLabel:"Empresa:",companyOther:"Otra",companyLinkLabel:"Enlace Perfil Empresa en TMP:",truckersmpLinkLabel:"Enlace Perfil en TMP:",validLink:"Enlace vÃ¡lido",invalidLink:"Enlace invÃ¡lido: debe ser https://truckersmp.com/user/[nÃºmero]",downloadButton:"Descargar Licencia",canvasName:"Nombre :",canvasLicenseNo:"NÃºm. Licencia :",canvasDate:"Fecha :",canvasCountry:"PaÃ­s :",canvasTag:"TAG :",titleNormal:"PERMISO DE CONDUCCIÃ“N INTERNACIONAL",titleComedic:"PERMISO PARA CHOCAR EN CONVOY",countryPlaceholder:"Seleccione un paÃ­s",colorLabel:"Tono del fondo:"},
    en:{pageTitle:"Convoyrama | Driver License Generator",headerTitle:"Driver License Generator",navLicense:"License",fontLabel:"Font: ",nameLabel:"Name:",nicknameLabel:"Epic TAG:",titleToggleLabel:"Use comedic title:",photoLabel:"Photo (Optional):",countryLabel:"Country:",companyLabel:"Company:",companyOther:"Other",companyLinkLabel:"TruckersMP Company Profile Link:",truckersmpLinkLabel:"TruckersMP Profile Link:",validLink:"Valid link",invalidLink:"Invalid link: must be https://truckersmp.com/user/[number]",downloadButton:"Download License",canvasName:"Name :",canvasLicenseNo:"License No. :",canvasDate:"Date :",canvasCountry:"Country :",canvasTag:"TAG :",titleNormal:"INTERNATIONAL DRIVING LICENSE",titleComedic:"CONVOY CRASHING PERMIT",countryPlaceholder:"Select a country",colorLabel:"Background hue:"},
    pt:{pageTitle:"Convoyrama | Gerador de LicenÃ§a",headerTitle:"Gerador de LicenÃ§a de Motorista",navLicense:"LicenÃ§a",fontLabel:"Fonte: ",nameLabel:"Nome:",nicknameLabel:"TAG Ã‰pico:",titleToggleLabel:"Usar tÃ­tulo cÃ´mico:",photoLabel:"Foto (Opcional):",countryLabel:"PaÃ­s:",companyLabel:"Empresa:",companyOther:"Outra",companyLinkLabel:"Link do Perfil da Empresa no TruckersMP:",truckersmpLinkLabel:"Link do Perfil no TruckersMP:",validLink:"Link vÃ¡lido",invalidLink:"Link invÃ¡lido: deve ser https://truckersmp.com/user/[nÃºmero]",downloadButton:"Baixar LicenÃ§a",canvasName:"Nome :",canvasLicenseNo:"NÂº da LicenÃ§a :",canvasDate:"Data :",canvasCountry:"PaÃ­s :",canvasTag:"TAG :",titleNormal:"LICENÃ‡A INTERNACIONAL DE CONDUÃ‡ÃƒO",titleComedic:"PERMISSÃƒO PARA BATER EM CONVOI",countryPlaceholder:"Selecione um paÃ­s",colorLabel:"Tom do fundo:"}
    },nomInp=document.getElementById("nombre"),fotoInp=document.getElementById("foto"),paisInp=document.getElementById("pais"),nickInp=document.getElementById("nickname"),empInp=document.getElementById("empresa"),empLinkInp=document.getElementById("empresaLink"),tmpLinkInp=document.getElementById("truckersmpLink"),tmpStatus=document.getElementById("truckersmpStatus"),empGrp=document.getElementById("empresaGroup"),empLinkGrp=document.getElementById("empresaLinkGroup"),nickGrp=document.getElementById("nicknameGroup"),titleGrp=document.getElementById("titleToggleGroup"),titleTog=document.getElementById("titleToggle"),promodsTog=document.getElementById("promodsToggle"),dbusTog=document.getElementById("dbusworldToggle"),langTog=document.getElementById("languageToggle"),clrSlider=document.getElementById("colorSlider"),clrVal=document.getElementById("colorValue");
    let usrImg=null,nickUnlock=localStorage.getItem("nicknameUnlocked")==="true",cacheDate=null,lastFetch=0,DATE_CACHE=60*1000,curLang="es";
    async function getDate(){const now=Date.now();if(cacheDate&&now-lastFetch<DATE_CACHE) return cacheDate;const apis=[{url:'https://worldtimeapi.org/api/timezone/Etc/UTC',parse:d=>{const dt=new Date(d.datetime);return{day:dt.getDate().toString().padStart(2,"0"),month:(dt.getMonth()+1).toString().padStart(2,"0"),year:dt.getFullYear()}}},{url:'https://timeapi.io/api/Time/current/utc',parse:d=>({day:d.day.toString().padStart(2,"0"),month:d.month.toString().padStart(2,"0"),year:d.year})},{url:'https://worldclockapi.herokuapp.com/api/json/utc/now',parse:d=>{const dt=new Date(d.currentDateTime);return{day:dt.getDate().toString().padStart(2,"0"),month:(dt.getMonth()+1).toString().padStart(2,"0"),year:dt.getFullYear()}}}];for(const api of apis){try{const res=await fetch(api.url),data=await res.json(),{day,month,year}=api.parse(data);cacheDate=`${day}/${month}/${year}`;lastFetch=now;return cacheDate}catch(e){}}const dt=new Date,day=dt.getDate().toString().padStart(2,"0"),month=(dt.getMonth()+1).toString().padStart(2,"0"),year=dt.getFullYear();cacheDate=`${day}/${month}/${year}`;lastFetch=now;return cacheDate}
    function updLang(l){curLang=l;const t=trans[l];document.getElementById("pageTitle").textContent=t.pageTitle;document.getElementById("headerTitle").textContent=t.headerTitle;document.getElementById("navLicense").textContent=t.navLicense;document.getElementById("fontLabel").innerHTML=t.fontLabel+'<span id="fontName">Open Sans</span>';document.getElementById("nameLabel").textContent=t.nameLabel;document.getElementById("nicknameLabel").textContent=t.nicknameLabel;document.getElementById("titleToggleLabel").textContent=t.titleToggleLabel;document.getElementById("photoLabel").textContent=t.photoLabel;document.getElementById("countryLabel").textContent=t.countryLabel;document.getElementById("companyLabel").textContent=t.companyLabel;document.getElementById("companyLinkLabel").textContent=t.companyLinkLabel;document.getElementById("truckersmpLinkLabel").textContent=t.truckersmpLinkLabel;document.getElementById("colorLabel").textContent=t.colorLabel;document.getElementById("botonDescargar").textContent=t.downloadButton;paisInp.options[0].text=t.countryPlaceholder;const empSel=empInp;for(let i=0;i<empSel.options.length;i++){if(empSel.options[i].value==="Otro") empSel.options[i].text=t.companyOther}const link=tmpLinkInp.value.trim();if(link) valTmpLink(link);dbGenImg()}
    function genLicNum(n,p,l){const cc=p.split("|")[0].substring(0,2)||"XX";let uid="";if(l){const m=l.match(/truckersmp\.com\/user\/(\d+)/);uid=m?m[1]:""}return uid?`${cc}${uid}`:""}
    function valTmpLink(l){const r=/^https:\/\/truckersmp\.com\/user\/\d+$/,t=trans[curLang];if(!r.test(l)){tmpStatus.textContent=t.invalidLink;tmpStatus.className="invalid";return false}tmpStatus.textContent=t.validLink;tmpStatus.className="valid";return true}
    function dbounce(f,w){let t;return function(...a){const l=()=>{clearTimeout(t);f(...a)};clearTimeout(t);t=setTimeout(l,w)}}
    function saveCntry(){localStorage.setItem("defaultCountry",paisInp.value)}
    function loadCntry(){const s=localStorage.getItem("defaultCountry");if(s) paisInp.value=s}
    function updForm(){const e=empInp.value;empLinkGrp.classList.toggle("hidden",e!=="Otro");const clrMap={'LS':260,'CN':340,'TCS':200,'Otro':clrSlider.value},newClr=clrMap[e]||0;clrSlider.value=newClr;clrVal.textContent=`${newClr}Â°`;const n=nomInp.value.toLowerCase().trim();if(["convoyrama","nocturnoverso"].includes(n)){nickUnlock=true;localStorage.setItem("nicknameUnlocked","true")}nickGrp.classList.toggle("hidden",!nickUnlock);titleGrp.classList.toggle("hidden",!nickUnlock);dbGenImg()}
    let lastState={};
    function getState(){return{nombre:nomInp.value,pais:paisInp.value,nickname:nickInp.value,empresa:empInp.value,truckersmpLink:tmpLinkInp.value,empresaLink:empLinkInp.value,titleToggle:titleTog.checked,promodsToggle:promodsTog.checked,dbusworldToggle:dbusTog.checked,userImage:usrImg?usrImg.src:null,language:curLang,colorHue:clrSlider.value}}
    async function genImg(){const fs=getState();if(JSON.stringify(fs)===JSON.stringify(lastState)) return;lastState=fs;const t=trans[curLang],n=nomInp.value||(curLang==="es"?"Sin nombre":curLang==="en"?"No name":"Sem nome"),pd=paisInp.value.split("|"),cc=pd[0]||"XX",flag=pd[1]||"",cn=pd[2]||(curLang==="es"?"Sin paÃ­s":curLang==="en"?"No country":"Sem paÃ­s"),nick=nickInp.value||"",e=empInp.value,tl=tmpLinkInp.value.trim(),el=empLinkInp.value.trim(),isValid=tl?valTmpLink(tl):false,hr=parseInt(clrSlider.value);if(cnv.width!==800||cnv.height!==500){cnv.width=800;cnv.height=500}
    ctx.clearRect(0,0,cnv.width,cnv.height);ctx.font=null;ctx.fillStyle=null;ctx.textAlign="start";ctx.textBaseline="alphabetic";ctx.shadowColor="transparent";ctx.globalCompositeOperation="source-over";ctx.filter="none";const tImgSrc={'LS':'./assets/images/license_template_ls.png','TCS':'./assets/images/license_template_tcs.png','CN':'./assets/images/license_template_cn.png','Otro':'./assets/images/license_template_otro.png'}[e]||'./assets/images/license_template_otro.png',tImg=new Image;tImg.src=tImgSrc,eImgSrc={'LS':'./assets/images/lsb.png','TCS':'./assets/images/tcsb.png','CN':'./assets/images/cnb.png','Otro':'./assets/images/otrosb.png'}[e]||'./assets/images/otrosb.png',eImg=new Image;eImg.src=eImgSrc,iImgSrc={'es':'./assets/images/es.png','en':'./assets/images/en.png','pt':'./assets/images/pt.png'}[curLang],iImg=new Image;iImg.src=iImgSrc,vImgSrc=e==="Otro"&&el&&vtcMap[el]?`./assets/images/vtc/${vtcMap[el]}`:null,vImg=vImgSrc?new Image:null;if(vImg) vImg.src=vImgSrc;const [tImgL,eImgL,iImgL,sImg,fImg,idImg,lQrImg,pImg,dImg,vLogo]=await Promise.all([new Promise(r=>{tImg.onload=()=>{r(tImg)};tImg.onerror=()=>{r(null)}}),new Promise(r=>{eImg.onload=()=>{r(eImg)};eImg.onerror=()=>{r(null)}}),new Promise(r=>{iImg.onload=()=>{r(iImg)};iImg.onerror=()=>{r(null)}}),usrImg?Promise.resolve(null):rTwemoji("ğŸ‘¤",cfg.defaultPhotoSize),flag?rTwemoji(flag,cfg.flagSize):Promise.resolve(null),isValid?new Promise(r=>{const i=new Image;i.src="./assets/images/id.svg";i.onload=()=>{r(i)};i.onerror=()=>{r(null)}}):Promise.resolve(null),isValid&&(e==="LS"||e==="CN"||e==="TCS")?new Promise(r=>{const i=new Image;i.src=`./assets/images/qr${e.toLowerCase()}.svg`;i.onload=()=>{r(i)};i.onerror=()=>{r(null)}}):isValid&&el&&e==="Otro"?new Promise(r=>{const qr=new QRious({value:el,size:cfg.qrSize,level:'H'}),qrCnv=document.createElement("canvas");qrCnv.width=cfg.qrSize;qrCnv.height=cfg.qrSize;const qrCtx=qrCnv.getContext("2d");qrCtx.drawImage(qr.canvas,0,0);r(qrCnv)}):Promise.resolve(null),promodsTog.checked?new Promise(r=>{const i=new Image;i.src="./assets/images/promods.png";i.onload=()=>{r(i)};i.onerror=()=>{r(null)}}):Promise.resolve(null),dbusTog.checked?new Promise(r=>{const i=new Image;i.src="./assets/images/dbusworld.png";i.onload=()=>{r(i)};i.onerror=()=>{r(null)}}):Promise.resolve(null),vImg?new Promise(r=>{vImg.onload=()=>{r(vImg)};vImg.onerror=()=>{r(null)}}):Promise.resolve(null)]);
    if(tImgL){ctx.filter=`hue-rotate(${hr}deg)`;ctx.drawImage(tImgL,0,0,cnv.width,cnv.height);ctx.filter="none"}else{ctx.fillStyle="#fff";ctx.fillRect(0,0,cnv.width,cnv.height)}if(eImgL) ctx.drawImage(eImgL,0,0,cnv.width,cnv.height);if(iImgL) ctx.drawImage(iImgL,0,0,cnv.width,cnv.height);if(usrImg){const ps=cfg.defaultPhotoSize;ctx.drawImage(usrImg,cfg.photoX,cfg.photoY,ps,ps)}else if(sImg){ctx.drawImage(sImg,cfg.photoX,cfg.photoY,cfg.defaultPhotoSize,cfg.defaultPhotoSize)}if(fImg) ctx.drawImage(fImg,cfg.flagX-cfg.flagSize/2,cfg.flagY,cfg.flagSize,cfg.flagSize);if(vLogo&&e==="Otro"&&isValid){const vh=cfg.vtcLogoHeight,vw=vLogo?(vLogo.width/vLogo.height)*vh:vh,vx=cfg.flagX-cfg.flagSize/2-70-vw/2,vy=cfg.qrY+cfg.qrSize+10;ctx.drawImage(vLogo,vx,vy,vw,vh)}const cd=await getDate();ctx.font=`bold 24px ${cfg.font}`;ctx.fillStyle=cfg.color;ctx.textAlign="left";const lh=24*1.2;ctx.fillText(t.canvasName,cfg.labelX,cfg.textY);ctx.fillText(t.canvasLicenseNo,cfg.labelX,cfg.textY+lh);ctx.fillText(t.canvasDate,cfg.labelX,cfg.textY+lh*2);ctx.fillText(t.canvasCountry,cfg.labelX,cfg.textY+lh*3);if(nickUnlock&&nick) ctx.fillText(t.canvasTag,cfg.labelX,cfg.textY+lh*4);ctx.fillText(n,cfg.textX,cfg.textY);if(n&&n.trim()!==""&&paisInp.value&&isValid){const ln=genLicNum(n,paisInp.value,tl);if(ln) ctx.fillText(ln,cfg.textX,cfg.textY+lh)}ctx.fillText(cd,cfg.textX,cfg.textY+lh*2);ctx.fillText(cn,cfg.textX,cfg.textY+lh*3);if(nickUnlock&&nick) ctx.fillText(nick,cfg.textX,cfg.textY+lh*4);if(pImg&&promodsTog.checked) ctx.drawImage(pImg,cfg.promodsX,cfg.promodsY,cfg.logoWidth,cfg.logoHeight);if(dImg&&dbusTog.checked){const dy=promodsTog.checked?cfg.dbusworldY:cfg.promodsY;ctx.drawImage(dImg,cfg.dbusworldX,dy,cfg.logoWidth,cfg.logoHeight)}const starMap={"https://truckersmp.com/user/627943":2,"https://truckersmp.com/user/5441056":1,"https://truckersmp.com/user/5429829":3,"https://truckersmp.com/user/5408877":1,"https://truckersmp.com/user/5379466":3,"https://truckersmp.com/user/5861450":2,"https://truckersmp.com/user/4690862":3,"https://truckersmp.com/user/1432064":2,"https://truckersmp.com/user/4890784":2},sc=starMap[tl]||0;
    if(sc>0){ctx.font=`bold 24px ${cfg.font}`;ctx.fillStyle="#FFD700";ctx.textAlign="right";const sx=cnv.width-20;for(let i=0;i<sc;i++){const sy=cfg.promodsY+i*24;ctx.fillText("â˜…",sx,sy)}}const tt=nickUnlock&&titleTog.checked?t.titleComedic:t.titleNormal,ty=cnv.height-5;ctx.font=`bold 22px ${cfg.font}`;ctx.fillStyle="rgb(240, 240, 240)";ctx.textAlign="center";ctx.textBaseline="bottom";ctx.shadowColor="rgb(0, 0, 0)";ctx.shadowOffsetX=1;ctx.shadowOffsetY=1;ctx.shadowBlur=2;ctx.fillText(tt,cnv.width/2,ty);ctx.shadowColor="transparent";if(isValid){const qr=new QRious({value:tl,size:cfg.qrSize,level:'H'}),qrCnv=document.createElement("canvas");qrCnv.width=cfg.qrSize;qrCnv.height=cfg.qrSize;const qrCtx=qrCnv.getContext("2d");qrCtx.drawImage(qr.canvas,0,0);ctx.drawImage(qrCnv,cfg.qrX,cfg.qrY,cfg.qrSize,cfg.qrSize);if(idImg) ctx.drawImage(idImg,cfg.qrX+cfg.qrSize+cfg.qrSpacing,cfg.qrY,cfg.qrSize,cfg.qrSize);if(lQrImg) ctx.drawImage(lQrImg,cfg.qrX-cfg.qrSize-cfg.qrSpacing,cfg.qrY,cfg.qrSize,cfg.qrSize)}updLink();function updLink(){const l=document.getElementById("descargar");l.href=cnv.toDataURL("image/png");l.download=`driver_license_${n}_${e}.png`}
    }
    fotoInp.addEventListener("change",e=>{const f=e.target.files[0];if(f){const r=new FileReader;r.onload=ev=>{usrImg=new Image;usrImg.src=ev.target.result;usrImg.onload=dbGenImg};r.readAsDataURL(f)}else{usrImg=null;dbGenImg()}});
    tmpLinkInp.addEventListener("input",()=>{const l=tmpLinkInp.value.trim();if(l){valTmpLink(l)}else{tmpStatus.textContent="";tmpStatus.className=""}dbGenImg()});
    langTog.addEventListener("change",()=>{updLang(langTog.value)});
    clrSlider.addEventListener("input",()=>{clrVal.textContent=`${clrSlider.value}Â°`;dbGenImg()});
    const dbGenImg=dbounce(genImg,100);
    [nomInp,paisInp,nickInp,empLinkInp,titleTog,promodsTog,dbusTog].forEach(el=>el.addEventListener("input",()=>{dbGenImg()}));
    paisInp.addEventListener("change",saveCntry);empInp.addEventListener("change",updForm);nomInp.addEventListener("input",updForm);
    async function init(){loadCntry();nickGrp.classList.toggle("hidden",!nickUnlock);titleGrp.classList.toggle("hidden",!nickUnlock);updLang(curLang);updForm();await dbGenImg()}
    init();
  </script>
</body>
</html>
