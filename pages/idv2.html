<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">Convoyrama | Generador de Licencia</title>
  <meta name="description" content="Convoyrama">
  <link rel="stylesheet" href="../assets/style.css">
  <link rel="icon" href="../assets/images/favicon.png">
  <link rel="apple-touch-icon" href="../assets/images/favicon.png">
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
  <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script>
  <style>
    @font-face {font-family:'Open Sans';src:url('./open-sans/OpenSans-Bold.ttf') format('truetype');font-weight:700;font-style:normal;}
    @font-face {font-family:'FiraSans-Bold';src:url('./fira-sans/FiraSans-Bold.ttf') format('truetype');font-weight:700;font-style:normal;}
    header {padding:15px;text-align:center;position:relative;z-index:10;background:var(--accent-bg);border-bottom:1px solid var(--border);}
    header p {font-size:1.2em;text-shadow:none;font-family:Arial,sans-serif;font-weight:normal;margin:10px 0;color:#fff;}
    nav {padding:10px;text-align:center;}
    nav a,nav a:visited {text-decoration:none;margin:0 15px;font-size:1em;text-shadow:none;color:#fff;}
    nav a:hover {text-decoration:underline;}
    .contenedor {display:flex;gap:15px;padding:15px;align-items:flex-start;font-family:Arial,sans-serif;}
    .panel {flex:1;max-width:250px;font-size:13px;}
    .panel h3 {margin:10px 0 5px;font-size:13px;}
    .input-group {margin:5px 0;}
    .toggle-group {display:flex;gap:8px;justify-content:space-between;}
    .toggle-group .toggle-item {flex:1;}
    canvas {border:1px solid #000;display:block;max-width:100%;height:auto;}
    #preview {flex:1;text-align:center;}
    button {padding:5px 10px;font-size:13px;margin-top:8px;background:rgb(90,165,25);color:#fff;border:none;border-radius:6px;cursor:pointer;}
    button:hover {opacity:0.8;}
    button.info-tooltip:hover::after {content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:5px 10px;border-radius:4px;font-size:12px;white-space:nowrap;z-index:10;}
    .hidden {display:none;}
    #truckersmpStatus,#empresaLinkStatus {font-size:11px;color:#555;margin-top:5px;}
    .valid {color:green;}
    .invalid {color:red;}
    #colorSlider {width:80%;margin-top:5px;vertical-align:middle;}
    #colorValue {display:inline-block;width:15%;text-align:right;font-size:13px;color:#555;}
    footer {margin:8px 0;}
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="../index.html">Home</a>
      <a href="pc.html">Creador de Perfil</a>
      <a href="id.html" id="navLicense">Licencia</a>
    </nav>
    <p id="headerTitle">Generador de Licencia de Conductor</p>
  </header>
  <div class="contenedor">
    <div class="panel">
      <div class="input-group"><label for="languageToggle">Idioma / Language / Língua:</label><br><select id="languageToggle" style="width:100%"><option value="es">Español</option><option value="en">English</option><option value="pt">Português</option></select></div>
      <div class="input-group"><label for="colorSlider" id="colorLabel">Tono del fondo:</label><br><input type="range" id="colorSlider" min="0" max="360" value="0" style="width:80%"><span id="colorValue">0°</span></div>
      <div class="input-group"><label for="nombre" id="nameLabel">Nombre:</label><br><input type="text" id="nombre" placeholder="Nombre / Name / Nome" required></div>
      <div class="input-group hidden" id="nicknameGroup"><label for="nickname" id="nicknameLabel">TAG Épico:</label><br><select id="nickname" style="width:100%"><option value="">Seleccione un TAG</option><option value="ReyDelLag">ReyDelLag</option><option value="FrenadorEnCurva">FrenadorEnCurva</option><option value="SeñorDelLagazo">SeñorDelLagazo</option><option value="BocinaLoca">BocinaLoca</option><option value="CargadorDeDeudas">CargadorDeDeudas</option><option value="CamioneroDelApagón">CamioneroDelApagón</option><option value="FugitivoDeLaRuta">FugitivoDeLaRuta</option><option value="MaestroDelPing">MaestroDelPing</option><option value="ReyDeLaCarretera">ReyDeLaCarretera</option><option value="LocoDelVolante">LocoDelVolante</option><option value="SobrevivienteDelBan">SobrevivienteDelBan</option><option value="BanEvasor">BanEvasor</option><option value="FrenazoEstelar">FrenazoEstelar</option><option value="TerrorDeCalais">TerrorDeCalais</option><option value="LagLegendario">LagLegendario</option><option value="SobrevivienteDeKirkenes">SobrevivienteDeKirkenes</option><option value="MaestroDelReckless">MaestroDelReckless</option><option value="PingParalizante">PingParalizante</option><option value="RutaSinRetorno">RutaSinRetorno</option><option value="VolanteEndemoniado">VolanteEndemoniado</option><option value="AsDelReporte">AsDelReporte</option><option value="ReyDeDuisburg">ReyDeDuisburg</option><option value="ReyDeCalais">ReyDeCalais</option><option value="KaosEnLaRuta">KaosEnLaRuta</option><option value="CarreteraPerdida">CarreteraPerdida</option><option value="FrenadorDePánico">FrenadorDePánico</option><option value="CargaConDrama">CargaConDrama</option></select></div>
      <div class="input-group hidden" id="titleToggleGroup"><label for="titleToggle" id="titleToggleLabel">Usar título cómico:</label><br><input type="checkbox" id="titleToggle"></div>
      <div class="input-group"><label for="foto" id="photoLabel">Foto (Opcional):</label><br><input type="file" id="foto" accept="image/*"></div>
      <div class="input-group"><label for="pais" id="countryLabel">País:</label><br><select id="pais" style="width:100%" required><option value="">Seleccione un país / Select a country / Selecione um país</option><option value="AO|🇦🇴|Angola|Angola|Angola">🇦🇴 Angola</option><option value="AR|🇦🇷|Argentina|Argentina|Argentina">🇦🇷 Argentina</option><option value="BO|🇧🇴|Bolivia|Bolivia|Bolívia">🇧🇴 Bolivia</option><option value="BR|🇧🇷|Brasil|Brazil|Brasil">🇧🇷 Brasil</option><option value="BZ|🇧🇿|Belice|Belize|Belize">🇧🇿 Belice</option><option value="CA|🇨🇦|Canadá|Canada|Canadá">🇨🇦 Canadá</option><option value="CL|🇨🇱|Chile|Chile|Chile">🇨🇱 Chile</option><option value="CN|🇨🇳|China|China|China">🇨🇳 China</option><option value="CO|🇨🇴|Colombia|Colombia|Colômbia">🇨🇴 Colombia</option><option value="CR|🇨🇷|Costa Rica|Costa Rica|Costa Rica">🇨🇷 Costa Rica</option><option value="CU|🇨🇺|Cuba|Cuba|Cuba">🇨🇺 Cuba</option><option value="DE|🇩🇪|Alemania|Germany|Alemanha">🇦🇪 Alemania</option><option value="DO|🇩🇴|República Dominicana|Dominican Republic|República Dominicana">🇩🇴 República Dominicana</option><option value="EC|🇪🇨|Ecuador|Ecuador|Equador">🇪🇨 Ecuador</option><option value="ES|🇪🇸|España|Spain|Espanha">🇪🇸 España</option><option value="FR|🇫🇷|Francia|France|França">🇫🇷 Francia</option><option value="GB|🇬🇧|Reino Unido|United Kingdom (England/Scotland)|Reino Unido">🇬🇧 Reino Unido</option><option value="GT|🇬🇹|Guatemala|Guatemala|Guatemala">🇬🇹 Guatemala</option><option value="GY|🇬🇾|Guyana|Guyana|Guiana">🇬🇾 Guyana</option><option value="HN|🇭🇳|Honduras|Honduras|Honduras">🇭🇳 Honduras</option><option value="IE|🇮🇪|Irlanda|Ireland|Irlanda">🇮🇪 Irlanda</option><option value="IT|🇮🇹|Italia|Italy|Itália">🇮🇹 Italia</option><option value="JM|🇯🇲|Jamaica|Jamaica|Jamaica">🇯🇲 Jamaica</option><option value="JP|🇯🇵|Japón|Japan|Japão">🇯🇵 Japón</option><option value="MX|🇲🇽|México|Mexico|México">🇲🇽 México</option><option value="MZ|🇲🇿|Mozambique|Mozambique|Moçambique">🇲🇿 Mozambique</option><option value="NI|🇳🇮|Nicaragua|Nicaragua|Nicarágua">🇳🇮 Nicaragua</option><option value="PA|🇵🇦|Panamá|Panama|Panamá">🇵🇦 Panamá</option><option value="PE|🇵🇪|Perú|Peru|Peru">🇵🇪 Perú</option><option value="PI|🏴‍☠️|Pirata|Pirate|Pirata">🏴‍☠️ Pirata</option><option value="PL|🇵🇱|Polonia|Poland|Polônia">🇵🇱 Polonia</option><option value="PT|🇵🇹|Portugal|Portugal|Portugal">🇵🇹 Portugal</option><option value="PY|🇵🇾|Paraguay|Paraguay|Paraguai">🇵🇾 Paraguay</option><option value="RO|🇷🇴|Rumania|Romania|Romênia">🇷🇴 Rumania</option><option value="RU|🇷🇺|Rusia|Russia|Rússia">🇷🇺 Rusia</option><option value="SR|🇸🇷|Surinam|Suriname|Suriname">🇸🇷 Surinam</option><option value="SV|🇸🇻|El Salvador|El Salvador|El Salvador">🇸🇻 El Salvador</option><option value="TR|🇹🇷|Turquía|Turkey|Turquia">🇹🇷 Turquía</option><option value="UA|🇺🇦|Ucrania|Ukraine|Ucrânia">🇺🇦 Ucrania</option><option value="US|🇺🇸|Estados Unidos|United States|Estados Unidos">🇺🇸 Estados Unidos</option><option value="UY|🇺🇾|Uruguay|Uruguay|Uruguai" selected>🇺🇾 Uruguay</option><option value="VE|🇻🇪|Venezuela|Venezuela|Venezuela">🇻🇪 Venezuela</option></select></div>
      <div class="input-group"><label for="empresaLink" id="companyLinkLabel">Enlace Perfil Empresa en TMP:</label><br><input type="text" id="empresaLink" placeholder="TruckersMP Company Profile Link" required><div id="empresaLinkStatus"></div></div>
      <div class="input-group"><label for="truckersmpLink" id="truckersmpLinkLabel">Enlace Perfil en TMP:</label><br><input type="text" id="truckersmpLink" placeholder="TruckersMP Profile Link" required><div id="truckersmpStatus"></div></div>
      <div class="input-group toggle-group"><div class="toggle-item"><label for="promodsToggle">ProMods:</label><br><input type="checkbox" id="promodsToggle"></div><div class="toggle-item"><label for="dbusworldToggle">DBUS:</label><br><input type="checkbox" id="dbusworldToggle"></div></div>
    </div>
    <div id="preview">
      <canvas id="canvas" width="800" height="500"></canvas>
      <br>
      <a id="descargar" download="driver_license.png"><button id="botonDescargar" class="info-tooltip" data-tooltip="Esta licencia es una broma y un guiño a la comunidad, no pretende ser profesional ni seria.">Descargar Licencia</button></a>
    </div>
  </div>
  <footer><small>© LAG'S SPEED - CONVOYRAMA 2025 - v2</small></footer>
  <script>
    function rT(e,s){return new Promise(r=>{const i=new Image();i.onload=() => r(i);i.onerror=() => r(null);i.src=twemoji.parse(e,{folder:'svg',ext:'.svg'}).match(/src="([^"]+)"/)[1];i.crossOrigin="anonymous";})}
    const cv=document.getElementById("canvas"),ctx=cv.getContext("2d"),cfg={color:"white",flagSize:80,photoX:45,photoY:80,labelX:100,colonX:130,textX:295,textY:334,qrX:573,qrY:101,flagX:625,flagY:206,font:"'Open Sans', Arial, sans-serif",defaultPhotoSize:192,qrSize:100,qrSpacing:10,promodsX:20,promodsY:334,dbusworldX:20,dbusworldY:394,logoWidth:67,logoHeight:50,vtcLogoSize:100};
    const vtcM={"https://truckersmp.com/vtc/78865":"ls.png","https://truckersmp.com/vtc/76978":"tcs.png","https://truckersmp.com/vtc/55250-andesvtc":"andes.png","https://truckersmp.com/vtc/55250":"andes.png","https://truckersmp.com/vtc/29591":"castores.jpg","https://truckersmp.com/vtc/81636":"chapu.jpeg","https://truckersmp.com/vtc/55439-destiny":"destiny.png","https://truckersmp.com/vtc/55439":"destiny.png","https://truckersmp.com/vtc/56572-lsavtc":"lsa.png","https://truckersmp.com/vtc/56572":"lsa.png","https://truckersmp.com/vtc/79357":"norte.png","https://truckersmp.com/vtc/34966-nova-era":"nova.png","https://truckersmp.com/vtc/34966":"nova.png","https://truckersmp.com/vtc/64312":"shipeados.png","https://truckersmp.com/vtc/65011":"tl.png","https://truckersmp.com/vtc/17910-transportesatr":"atr.png","https://truckersmp.com/vtc/17910":"atr.png","https://truckersmp.com/vtc/63758":"cord.jpg","https://truckersmp.com/vtc/48970":"sin.jpg","https://truckersmp.com/vtc/70703":"as.png","https://truckersmp.com/vtc/77802":"ex.png","https://truckersmp.com/vtc/62448":"rut.jpg","https://truckersmp.com/vtc/11715":"avant.png","https://truckersmp.com/vtc/76975":"titan.png","https://truckersmp.com/vtc/3414":"baltico.png","https://truckersmp.com/vtc/79130":"corr.png","https://truckersmp.com/vtc/74222":"esp.jpg","https://truckersmp.com/vtc/63303":"coo.png","https://truckersmp.com/vtc/1271":"ali.png","https://truckersmp.com/vtc/50578":"tcc.png","https://truckersmp.com/vtc/56350":"gaat.png","https://truckersmp.com/vtc/2436":"go.png"};
    const t={es:{pageTitle:"Convoyrama | Generador de Licencia",headerTitle:"Generador de Licencia de Conductor",navLicense:"Licencia",nameLabel:"Nombre:",nicknameLabel:"TAG Épico:",titleToggleLabel:"Usar título cómico:",photoLabel:"Foto (Opcional):",countryLabel:"País:",companyLinkLabel:"Enlace Perfil Empresa en TMP:",truckersmpLinkLabel:"Enlace Perfil en TMP:",validLink:"Enlace válido",invalidLink:"Enlace inválido: debe ser https://truckersmp.com/user/[...]",validCompanyLink:"Enlace de empresa válido",invalidCompanyLink:"Enlace inválido: debe ser https://truckersmp.com/vtc/[...]",downloadButton:"Descargar Licencia",canvasName:"Nombre :",canvasLicenseNo:"Núm. Licencia :",canvasDate:"Fecha :",canvasCountry:"País :",canvasTag:"TAG :",titleNormal:"PERMISO DE CONDUCCIÓN INTERNACIONAL",titleComedic:"PERMISO PARA CHOCAR EN CONVOY",countryPlaceholder:"Seleccione un país",colorLabel:"Tono del fondo:",tooltipMessage:"Esta licencia es una broma y un guiño a la comunidad, no pretende ser profesional ni seria."},en:{pageTitle:"Convoyrama | Driver License Generator",headerTitle:"Driver License Generator",navLicense:"License",nameLabel:"Name:",nicknameLabel:"Epic TAG:",titleToggleLabel:"Use comedic title:",photoLabel:"Photo (Optional):",countryLabel:"Country:",companyLinkLabel:"TruckersMP Company Profile Link:",truckersmpLinkLabel:"TruckersMP Profile Link:",validLink:"Valid link",invalidLink:"Invalid link: must be https://truckersmp.com/user/[...]",validCompanyLink:"Valid company link",invalidCompanyLink:"Invalid link: must be https://truckersmp.com/vtc/[...]",downloadButton:"Download License",canvasName:"Name :",canvasLicenseNo:"License No. :",canvasDate:"Date :",canvasCountry:"Country :",canvasTag:"TAG :",titleNormal:"INTERNATIONAL DRIVING LICENSE",titleComedic:"CONVOY CRASHING PERMIT",countryPlaceholder:"Select a country",colorLabel:"Background hue:",tooltipMessage:"This license is a joke and a nod to the community, not intended to be professional or serious."},pt:{pageTitle:"Convoyrama | Gerador de Licença",headerTitle:"Gerador de Licença de Motorista",navLicense:"Licença",nameLabel:"Nome:",nicknameLabel:"TAG Épico:",titleToggleLabel:"Usar título cômico:",photoLabel:"Foto (Opcional):",countryLabel:"País:",companyLinkLabel:"Link do Perfil da Empresa no TruckersMP:",truckersmpLinkLabel:"Link do Perfil no TruckersMP:",validLink:"Link válido",invalidLink:"Link inválido: deve ser https://truckersmp.com/user/[...]",validCompanyLink:"Link de empresa válido",invalidCompanyLink:"Link inválido: deve ser https://truckersmp.com/vtc/[...]",downloadButton:"Baixar Licença",canvasName:"Nome :",canvasLicenseNo:"Nº da Licença :",canvasDate:"Data :",canvasCountry:"País :",canvasTag:"TAG :",titleNormal:"LICENÇA INTERNACIONAL DE CONDUCCIÓN",titleComedic:"PERMISSÃO PARA BATER EM CONVOI",countryPlaceholder:"Selecione um país",colorLabel:"Tom do fundo:",tooltipMessage:"Esta licença é uma brincadeira e uma homenagem à comunidade, não pretende ser profissional ou séria."}};
    const nInp=document.getElementById("nombre"),fInp=document.getElementById("foto"),pInp=document.getElementById("pais"),nickInp=document.getElementById("nickname"),eLinkInp=document.getElementById("empresaLink"),tLinkInp=document.getElementById("truckersmpLink"),tStat=document.getElementById("truckersmpStatus"),eStat=document.getElementById("empresaLinkStatus"),nickGrp=document.getElementById("nicknameGroup"),tTogGrp=document.getElementById("titleToggleGroup"),tTogInp=document.getElementById("titleToggle"),pTogInp=document.getElementById("promodsToggle"),dTogInp=document.getElementById("dbusworldToggle"),lTog=document.getElementById("languageToggle"),cSld=document.getElementById("colorSlider"),cVal=document.getElementById("colorValue"),iTip=document.getElementById("botonDescargar");
    let uImg=null,isNickUnl=localStorage.getItem("nicknameUnlocked")==="true",cDate=null,lDateF=0,DATE_CACHE_DUR=180000,curLang="es";
    async function gDate(){const n=Date.now();if(cDate&&n-lDateF<DATE_CACHE_DUR)return cDate;const a=[{url:'https://worldtimeapi.org/api/timezone/Etc/UTC',parse:d=>{const dt=new Date(d.datetime);return{day:dt.getDate().toString().padStart(2,"0"),month:(dt.getMonth()+1).toString().padStart(2,"0"),year:dt.getFullYear()}}},{url:'https://timeapi.io/api/Time/current/utc',parse:d=>({day:d.day.toString().padStart(2,"0"),month:d.month.toString().padStart(2,"0"),year:d.year})},{url:'https://worldclockapi.herokuapp.com/api/json/utc/now',parse:d=>{const dt=new Date(d.currentDateTime);return{day:dt.getDate().toString().padStart(2,"0"),month:(dt.getMonth()+1).toString().padStart(2,"0"),year:dt.getFullYear()}}}];for(const api of a){try{const r=await fetch(api.url),d=await r.json(),{day,month,year}=api.parse(d);cDate=`${day}/${month}/${year}`;lDateF=n;return cDate;}catch(e){}}const d=new Date();cDate=`${d.getDate().toString().padStart(2,"0")}/${(d.getMonth()+1).toString().padStart(2,"0")}/${d.getFullYear()}`;lDateF=n;return cDate;}
    function uLang(l){curLang=l;const tr=t[l];document.getElementById("pageTitle").textContent=tr.pageTitle;document.getElementById("headerTitle").textContent=tr.headerTitle;document.getElementById("navLicense").textContent=tr.navLicense;document.getElementById("nameLabel").textContent=tr.nameLabel;document.getElementById("nicknameLabel").textContent=tr.nicknameLabel;document.getElementById("titleToggleLabel").textContent=tr.titleToggleLabel;document.getElementById("photoLabel").textContent=tr.photoLabel;document.getElementById("countryLabel").textContent=tr.countryLabel;document.getElementById("companyLinkLabel").textContent=tr.companyLinkLabel;document.getElementById("truckersmpLinkLabel").textContent=tr.truckersmpLinkLabel;document.getElementById("colorLabel").textContent=tr.colorLabel;document.getElementById("botonDescargar").textContent=tr.downloadButton;document.getElementById("botonDescargar").setAttribute("data-tooltip",tr.tooltipMessage);pInp.options[0].text=tr.countryPlaceholder;const tl=tLinkInp.value.trim(),el=eLinkInp.value.trim();if(tl)vTLink(tl);if(el)vELink(el);dGenImg();}
    function gLicNum(n,p,tl){const cc=p.split("|")[0].substring(0,2)||"XX";let ui="";if(tl){const m=tl.match(/truckersmp\.com\/user\/(.+)/);ui=m?m[1]:"";}return ui?`${cc}${ui}`:"";}
    function vTLink(l){const r=/^https:\/\/truckersmp\.com\/user\/.+$/,tr=t[curLang];if(!r.test(l)){tStat.textContent=tr.invalidLink;tStat.className="invalid";return false;}tStat.textContent=tr.validLink;tStat.className="valid";return true;}
    function vELink(l){const r=/^https:\/\/truckersmp\.com\/vtc\/.+$/,tr=t[curLang];if(!r.test(l)){eStat.textContent=tr.invalidCompanyLink;eStat.className="invalid";return false;}eStat.textContent=tr.validCompanyLink;eStat.className="valid";return true;}
    function db(f,w){let t;return function(...a){const l=()=>{clearTimeout(t);f(...a);};clearTimeout(t);t=setTimeout(l,w);};}
    function sDC(){localStorage.setItem("defaultCountry",pInp.value);}
    function lDC(){const s=localStorage.getItem("defaultCountry");if(s)pInp.value=s;}
    function uF(){const n=nInp.value.toLowerCase().trim();if(n==="resetnick"){isNickUnl=false;localStorage.removeItem("nicknameUnlocked");}else if(["convoyrama","nocturnoverso"].includes(n)){isNickUnl=true;localStorage.setItem("nicknameUnlocked","true");}nickGrp.classList.toggle("hidden",!isNickUnl);tTogGrp.classList.toggle("hidden",!isNickUnl);const el=eLinkInp.value.trim(),cm={"https://truckersmp.com/vtc/78865":260,"https://truckersmp.com/vtc/76978":200},nc=cm[el]||cSld.value;cSld.value=nc;cVal.textContent=`${nc}°`;if(el)vELink(el);dGenImg();}
    let lFS={};
    function gFS(){return{nombre:nInp.value,pais:pInp.value,nickname:nickInp.value,truckersmpLink:tLinkInp.value,empresaLink:eLinkInp.value,titleToggle:tTogInp.checked,promodsToggle:pTogInp.checked,dbusworldToggle:dTogInp.checked,userImage:uImg?uImg.src:null,language:curLang,colorHue:cSld.value};}
    async function gImg(){const fs=gFS();if(JSON.stringify(fs)===JSON.stringify(lFS))return;lFS=fs;const tr=t[curLang],n=nInp.value||(curLang==="es"?"Sin nombre":curLang==="en"?"No name":"Sem nome"),pd=pInp.value.split("|"),cc=pd[0]||"XX",f=pd[1]||"",cn=pd[2]||(curLang==="es"?"Sin país":curLang==="en"?"No country":"Sem país"),nick=nickInp.value||"",tl=tLinkInp.value.trim(),el=eLinkInp.value.trim(),isTValid=tl?vTLink(tl):false,isEValid=el?vELink(el):false,hr=parseInt(cSld.value);if(cv.width!==800||cv.height!==500){cv.width=800;cv.height=500;}ctx.save();ctx.clearRect(0,0,cv.width,cv.height);ctx.font=null;ctx.fillStyle=null;ctx.textAlign="start";ctx.textBaseline="alphabetic";ctx.shadowColor="transparent";ctx.globalCompositeOperation="source-over";ctx.filter="none";const tImg=new Image();tImg.src="./assets/images/license_template.png";const iSrc={'es':'./assets/images/es.png','en':'./assets/images/en.png','pt':'./assets/images/pt.png'}[curLang],iL=new Image();iL.src=iSrc;const vSrc=el&&vtcM[el]?`./assets/images/vtc/${vtcM[el]}`:null,vImg=vSrc?new Image():null;if(vImg)vImg.src=vSrc;const [tI,iLI,sI,fI,idI,pI,dI,vLI]=await Promise.all([new Promise(r=>{tImg.onload=() => r(tImg);tImg.onerror=() => r(null);}),new Promise(r=>{iL.onload=() => r(iL);iL.onerror=() => r(null);}),uImg?Promise.resolve(null):rT("👤",cfg.defaultPhotoSize),f?rT(f,cfg.flagSize):Promise.resolve(null),isTValid?new Promise(r=>{const i=new Image();i.src="./assets/images/id.svg";i.onload=() => r(i);i.onerror=() => r(null);}):Promise.resolve(null),pTogInp.checked?new Promise(r=>{const i=new Image();i.src="./assets/images/promods.png";i.onload=() => r(i);i.onerror=() => r(null);}):Promise.resolve(null),dTogInp.checked?new Promise(r=>{const i=new Image();i.src="./assets/images/dbusworld.png";i.onload=() => r(i);i.onerror=() => r(null);}):Promise.resolve(null),vImg?new Promise(r=>{vImg.onload=() => r(vImg);vImg.onerror=() => r(null);}):Promise.resolve(null)]);if(tI){ctx.filter=`hue-rotate(${hr}deg)`;ctx.drawImage(tI,0,0,cv.width,cv.height);ctx.filter="none";}else{ctx.fillStyle="#fff";ctx.fillRect(0,0,cv.width,cv.height);}if(iLI)ctx.drawImage(iLI,0,0,cv.width,cv.height);ctx.font="bold 30px FiraSans-Bold";ctx.fillStyle="#fff";ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText("TRUCKERSMP",cv.width/2,40.77);if(uImg)ctx.drawImage(uImg,cfg.photoX,cfg.photoY,cfg.defaultPhotoSize,cfg.defaultPhotoSize);else if(sI)ctx.drawImage(sI,cfg.photoX,cfg.photoY,cfg.defaultPhotoSize,cfg.defaultPhotoSize);if(fI)ctx.drawImage(fI,cfg.flagX-cfg.flagSize/2,cfg.flagY,cfg.flagSize,cfg.flagSize);if(vLI&&isEValid)ctx.drawImage(vLI,cfg.qrX-2*cfg.qrSize-2*cfg.qrSpacing,cfg.qrY,cfg.vtcLogoSize,cfg.vtcLogoSize);const cd=await gDate();ctx.font=`bold 24px ${cfg.font}`;ctx.fillStyle=cfg.color;ctx.textAlign="left";ctx.textBaseline="alphabetic";const lh=24*1.2;ctx.fillText(tr.canvasName,cfg.labelX,cfg.textY);ctx.fillText(tr.canvasLicenseNo,cfg.labelX,cfg.textY+lh);ctx.fillText(tr.canvasDate,cfg.labelX,cfg.textY+lh*2);ctx.fillText(tr.canvasCountry,cfg.labelX,cfg.textY+lh*3);if(isNickUnl&&nick)ctx.fillText(tr.canvasTag,cfg.labelX,cfg.textY+lh*4);ctx.fillText(n,cfg.textX,cfg.textY);if(n&&n.trim()!==""&&pInp.value&&isTValid){const ln=gLicNum(n,pInp.value,tl);if(ln)ctx.fillText(ln,cfg.textX,cfg.textY+lh);}ctx.fillText(cd,cfg.textX,cfg.textY+lh*2);ctx.fillText(cn,cfg.textX,cfg.textY+lh*3);if(isNickUnl&&nick)ctx.fillText(nick,cfg.textX,cfg.textY+lh*4);if(pI&&pTogInp.checked)ctx.drawImage(pI,cfg.promodsX,cfg.promodsY,cfg.logoWidth,cfg.logoHeight);if(dI&&dTogInp.checked){const dy=pTogInp.checked?cfg.dbusworldY:cfg.promodsY;ctx.drawImage(dI,cfg.dbusworldX,dy,cfg.logoWidth,cfg.logoHeight);}const sm={"https://truckersmp.com/user/627943":2,"https://truckersmp.com/user/5441056":1,"https://truckersmp.com/user/5429829":3,"https://truckersmp.com/user/5408877":1,"https://truckersmp.com/user/5379466":3,"https://truckersmp.com/user/5861450":2,"https://truckersmp.com/user/4690862":3,"https://truckersmp.com/user/1432064":2,"https://truckersmp.com/user/4890784":2},sc=sm[tl]||0;if(sc>0){ctx.font=`bold 24px ${cfg.font}`;ctx.fillStyle="#FFD700";ctx.textAlign="right";const sx=cv.width-20;for(let i=0;i<sc;i++){const sy=cfg.promodsY+i*24;ctx.fillText("★",sx,sy);}}const tt=isNickUnl&&tTogInp.checked?tr.titleComedic:tr.titleNormal,ty=cv.height-5;ctx.font=`bold 22px ${cfg.font}`;ctx.fillStyle="rgb(240,240,240)";ctx.textAlign="center";ctx.textBaseline="bottom";ctx.shadowColor="rgb(0,0,0)";ctx.shadowOffsetX=1;ctx.shadowOffsetY=1;ctx.shadowBlur=2;ctx.fillText(tt,cv.width/2,ty);ctx.shadowColor="transparent";if(isTValid){const qr=new QRious({value:tl,size:cfg.qrSize,level:'H'}),qc=document.createElement("canvas");qc.width=cfg.qrSize;qc.height=cfg.qrSize;qc.getContext("2d").drawImage(qr.canvas,0,0);ctx.drawImage(qc,cfg.qrX,cfg.qrY,cfg.qrSize,cfg.qrSize);if(idI)ctx.drawImage(idI,cfg.qrX+cfg.qrSize+cfg.qrSpacing,cfg.qrY,cfg.qrSize,cfg.qrSize);}if(isEValid){const qrE=new QRious({value:el,size:cfg.qrSize,level:'H'}),qcE=document.createElement("canvas");qcE.width=cfg.qrSize;qcE.height=cfg.qrSize;qcE.getContext("2d").drawImage(qrE.canvas,0,0);ctx.drawImage(qcE,cfg.qrX-cfg.qrSize-cfg.qrSpacing,cfg.qrY,cfg.qrSize,cfg.qrSize);}ctx.restore();uDL();}
    function uDL(){const l=document.getElementById("descargar"),n=nInp.value||"unknown";try{l.href=cv.toDataURL("image/png");l.download=`driver_license_${n}.png`;}catch(e){l.href="#";l.download="";}}
    fInp.addEventListener("change",e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>{uImg=new Image();uImg.src=ev.target.result;uImg.onload=dGenImg;};r.readAsDataURL(f);}else{uImg=null;dGenImg();}});
    tLinkInp.addEventListener("input",()=>{const l=tLinkInp.value.trim();if(l)vTLink(l);else{tStat.textContent="";tStat.className="";}dGenImg();});
    eLinkInp.addEventListener("input",()=>{const l=eLinkInp.value.trim();if(l)vELink(l);else{eStat.textContent="";eStat.className="";}dGenImg();});
    lTog.addEventListener("change",() => uLang(lTog.value));
    cSld.addEventListener("input",() => {cVal.textContent=`${cSld.value}°`;dGenImg();});
    const dGenImg=db(gImg,200);
    [nInp,pInp,nickInp,eLinkInp,tLinkInp,tTogInp,pTogInp,dTogInp].forEach(el => el.addEventListener("input",() => dGenImg()));
    pInp.addEventListener("change",sDC);
    nInp.addEventListener("input",uF);
    eLinkInp.addEventListener("input",uF);
    async function init(){lDC();nickGrp.classList.toggle("hidden",!isNickUnl);tTogGrp.classList.toggle("hidden",!isNickUnl);uLang(curLang);uF();await dGenImg();}init();
  </script>
</body>
</html>
