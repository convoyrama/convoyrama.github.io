<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title id="pageTitle">Convoyrama | Generador de Licencia</title><meta name="description" content="Convoyrama"><link rel="stylesheet" href="../assets/style.css"><link rel="icon" href="../assets/images/favicon.png"><link rel="apple-touch-icon" href="../assets/images/favicon.png"><script src="https://unpkg.com/qrcode-svg@1.1.0/dist/qrcode.min.js"></script><script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script><style>@font-face{font-family:Verdana;src:url(./verdana/Verdana.ttf) format('truetype');font-weight:400;font-style:normal}@font-face{font-family:Verdana-Bold;src:url(./verdana/Verdana-Bold.ttf) format('truetype');font-weight:700;font-style:normal}@font-face{font-family:Verdana-Italic;src:url(./verdana/Verdana-Italic.ttf) format('truetype');font-weight:400;font-style:italic}@font-face{font-family:Verdana-BoldItalic;src:url(./verdana/Verdana-BoldItalic.ttf) format('truetype');font-weight:700;font-style:italic}header{padding:15px;text-align:center;position:relative;z-index:10;background:var(--accent-bg);border-bottom:1px solid var(--border)}header p{font-size:1.2em;font-family:Arial,sans-serif;margin:10px 0;color:#fff}nav{padding:10px;text-align:center}nav a,nav a:visited{text-decoration:none;margin:0 15px;font-size:1em;color:#fff}nav a:hover{text-decoration:underline}.contenedor{display:flex;gap:15px;padding:15px;align-items:flex-start;font-family:Arial,sans-serif}.panel{flex:1;max-width:250px;font-size:13px}.panel h3{margin:10px 0 5px;font-size:13px}.input-group{margin:5px 0}.input-group input,.input-group select{width:230px;box-sizing:border-box;padding:8px;font-size:13px;border:1px solid #ccc;border-radius:4px}input[type="file"]{width:230px;box-sizing:border-box;font-size:13px;border:none;padding:8px 0}.toggle-item{margin:5px 0}.toggle-item input[type="checkbox"]{margin-right:5px}.toggle-group{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;align-items:center;margin:5px 0}.toggle-container{margin-top:10px;text-align:center}canvas{border:1px solid #000;display:block;margin:0 auto}#preview{flex:1;text-align:center}button{padding:5px 10px;font-size:13px;margin-top:8px;background:rgb(90,165,25);color:#fff;border:none;border-radius:6px;cursor:pointer}button:hover{opacity:0.8}button.info-tooltip:hover::after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:5px 10px;border-radius:4px;font-size:12px;white-space:pre-wrap;z-index:10}.hidden{display:none}#truckersmpStatus,#empresaLinkStatus{font-size:11px;color:#555;margin-top:5px}.valid{color:green}.invalid{color:red}#colorSlider,#saturationSlider{width:70%;margin-top:5px;vertical-align:middle;height:4px;background:#e0e0e0;border-radius:3px;outline:none;transition:background .3s}#colorSlider::-webkit-slider-thumb,#saturationSlider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:12px;height:12px;background:rgb(90,165,25);border-radius:50%;cursor:pointer;transition:background .3s}#colorSlider::-webkit-slider-thumb:hover,#saturationSlider::-webkit-slider-thumb:hover{background:rgb(70,130,20)}#colorSlider::-moz-range-thumb,#saturationSlider::-moz-range-thumb{width:12px;height:12px;background:rgb(90,165,25);border-radius:50%;cursor:pointer;border:none;transition:background .3s}#colorSlider::-moz-range-thumb:hover,#saturationSlider::-moz-range-thumb:hover{background:rgb(70,130,20)}#colorValue,#saturationValue{display:inline-block;width:15%;text-align:right;font-size:11px;color:#555}footer{margin:8px 0}#infoButton{font-size:12px;padding:3px 8px;margin-right:5px;display:inline-block}#infoButton:hover::after{width:200px;text-align:left}.button-group{display:flex;gap:5px;justify-content:center;align-items:center}.canvas-container{width:100%;text-align:center;margin:10px 0}#backgroundSelect{font-size:14px;padding:10px;width:250px}@media (max-width:767px){.contenedor{flex-direction:column;padding:10px}.panel{order:1;max-width:100%;width:100%}.input-group input,.input-group select{max-width:100%}input[type="file"]{max-width:100%}#preview{order:2;width:100%}canvas{max-width:100%;width:100%;height:auto}.canvas-container{max-width:100%}.toggle-group{flex-direction:column;gap:8px;margin-top:10px}.toggle-container{margin-top:15px}.toggle-item{width:100%;text-align:center}button{width:100%;max-width:200px;padding:8px;font-size:14px}#infoButton{max-width:50px}#colorSlider,#saturationSlider{width:60%}#colorValue,#saturationValue{width:20%}header p{font-size:1em}nav a{margin:0 10px;font-size:0.9em}#backgroundSelect{width:100%;max-width:300px;font-size:13px;padding:8px}}@media (min-width:768px){.contenedor{flex-direction:row;align-items:flex-start}.panel{max-width:250px}.input-group input,.input-group select{max-width:230px}input[type="file"]{max-width:230px}#preview{flex:1}canvas{width:400px;height:250px;transform:scale(1);transform-origin:top center}.toggle-group{flex-direction:row;justify-content:center}.button-group{flex-direction:row}button{width:auto}#backgroundSelect{width:250px}}</style></head><body><header><nav><a href="../index.html">Home</a><a href="pc.html">Creador de Perfil</a><a href="id.html" id="navLicense">Licencia</a></nav><p id="headerTitle">Generador de Licencia de Conductor</p></header><div class="contenedor"><div class="panel"><div class="input-group"><label for="languageToggle">Idioma / Language / Língua:</label><br><select id="languageToggle"><option value="es">Español</option><option value="en">English</option><option value="pt">Português</option></select></div><div class="input-group"><label for="customTitle" id="customTitleLabel">Cambiar título:</label><br><input type="text" id="customTitle" maxlength="36" placeholder="Título personalizado (máx. 36 caracteres, opcional)"></div><div class="input-group"><label for="nombre" id="nameLabel">Nombre:</label><br><input type="text" id="nombre" placeholder="Nombre / Name / Nome" required></div><div class="input-group"><label for="pais" id="countryLabel">País:</label><br><select id="pais" required><option value="">Seleccione un país / Select a country / Selecione um país</option></select></div><div class="input-group"><label for="truckersmpLink" id="truckersmpLinkLabel">Enlace Perfil en TMP:</label><br><input type="text" id="truckersmpLink" placeholder="TruckersMP Profile Link" required><div id="truckersmpStatus"></div></div><div class="input-group"><label for="empresaLink" id="companyLinkLabel">Enlace Perfil Empresa en TMP:</label><br><input type="text" id="empresaLink" placeholder="TruckersMP Company Profile Link" required><div id="empresaLinkStatus"></div></div><div class="input-group"><label for="foto" id="photoLabel">Foto (Opcional):</label><br><input type="file" id="foto" accept="image/*"></div><div class="input-group"><label for="vtcLogo" id="vtcLogoLabel">Logo VTC (Opcional):</label><br><input type="file" id="vtcLogo" accept="image/*"></div><div class="input-group hidden" id="nicknameGroup"><label for="nickname" id="nicknameLabel">TAG Épico:</label><br><select id="nickname"><option value="">Seleccione un TAG</option><option value="ReyDelLag">ReyDelLag</option><option value="FrenadorEnCurva">FrenadorEnCurva</option><option value="SeñorDelLagazo">SeñorDelLagazo</option><option value="BocinaLoca">BocinaLoca</option><option value="CargadorDeDeudas">CargadorDeDeudas</option><option value="CamioneroDelApagón">CamioneroDelApagón</option><option value="FugitivoDeLaRuta">FugitivoDeLaRuta</option><option value="MaestroDelPing">MaestroDelPing</option><option value="ReyDeLaCarretera">ReyDeLaCarretera</option><option value="LocoDelVolante">LocoDelVolante</option><option value="SobrevivienteDelBan">SobrevivienteDelBan</option><option value="BanEvasor">BanEvasor</option><option value="FrenazoEstelar">FrenazoEstelar</option><option value="TerrorDeCalais">TerrorDeCalais</option><option value="LagLegendario">LagLegendario</option><option value="SobrevivienteDeKirkenes">SobrevivienteDeKirkenes</option><option value="MaestroDelReckless">MaestroDelReckless</option><option value="PingParalizante">PingParalizante</option><option value="RutaSinRetorno">RutaSinRetorno</option><option value="VolanteEndemoniado">VolanteEndemoniado</option><option value="AsDelReporte">AsDelReporte</option><option value="ReyDeDuisburg">ReyDeDuisburg</option><option value="ReyDeCalais">ReyDeCalais</option><option value="KaosEnLaRuta">KaosEnLaRuta</option><option value="CarreteraPerdida">CarreteraPerdida</option><option value="FrenadorDePánico">FrenadorDePánico</option><option value="CargaConDrama">CargaConDrama</option></select></div><div class="toggle-item hidden" id="titleToggleGroup"><label for="titleToggle" id="titleToggleLabel">Usar título cómico:</label><br><input type="checkbox" id="titleToggle"></div></div><div id="preview"><div class="canvas-container"><canvas id="canvas"></canvas></div><div class="input-group"><label for="colorSlider" id="colorLabel">Tono del fondo:</label><br><input type="range" id="colorSlider" min="0" max="360" value="0"><span id="colorValue">0°</span></div><div class="input-group"><label for="saturationSlider" id="saturationLabel">Saturación:</label><br><input type="range" id="saturationSlider" min="0" max="200" value="100"><span id="saturationValue">100%</span></div><div class="button-group"><button id="infoButton" class="info-tooltip" data-tooltip="">?</button><a id="descargar" download="driver_license.png"><button id="botonDescargar" class="info-tooltip" data-tooltip="Esta licencia es una broma y un guiño a la comunidad, no pretende ser algo profesional.">Descargar Licencia</button></a></div><div class="toggle-container"><div class="toggle-group"><div class="toggle-item"><label for="promodsToggle">ProMods:</label><input type="checkbox" id="promodsToggle"></div><div class="toggle-item"><label for="dbusworldToggle">DBUS:</label><input type="checkbox" id="dbusworldToggle"></div><div class="toggle-item"><label for="watermarkToggle" id="watermarkToggleLabel">Usar marca de agua:</label><input type="checkbox" id="watermarkToggle" checked></div><div class="toggle-item"><label for="qrColorToggle" id="qrColorToggleLabel">Color QR: Oscuro / Claro</label><input type="checkbox" id="qrColorToggle"></div><div class="toggle-item"><label for="backgroundSelect" id="backgroundToggleLabel">Fondo:</label><br><select id="backgroundSelect"><option value="modern.png" selected>Modern</option><option value="classic.png">Classic</option><option value="aura.png">Aura</option><option value="rain.png">Rain</option></select></div></div></div></div></div><footer><small>© LAG'S SPEED - CONVOYRAMA 2025 - v1.1o</small></footer><script>function debounce(func,wait){let timeout;return function(...args){const later=()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout=setTimeout(later,wait);}}const debouncedGenerateImage=debounce(generateImage,100);const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");const config={baseWidth:800,baseHeight:500,color:"white",flagSize:80,photoX:45,photoY:80,labelX:100,textX:295,textY:314,qrX:573,qrY:101,flagX:580,flagY:206,font:"'Verdana', sans-serif",defaultPhotoSize:192,qrSize:100,qrSpacing:10,promodsX:20,promodsY:314,dbusworldX:20,dbusworldY:374,logoWidth:67,logoHeight:50,vtcLogoSize:100,titleFontSize:30,textFontSize:24,footerFontSize:22,watermarkWidth:180,watermarkHeight:180,lineHeight:28};const translations={es:{pageTitle:"Convoyrama | Generador de Licencia",headerTitle:"Generador de Licencia de Conductor",navLicense:"Licencia",nameLabel:"Nombre:",nicknameLabel:"TAG Épico:",titleToggleLabel:"Usar título cómico:",photoLabel:"Foto (Opcional):",countryLabel:"País:",companyLinkLabel:"Enlace Perfil Empresa en TMP:",truckersmpLinkLabel:"Enlace Perfil en TMP:",customTitleLabel:"Cambiar título:",watermarkToggleLabel:"Usar marca de agua:",qrColorToggleLabel:"Color QR: Oscuro / Claro",vtcLogoLabel:"Logo VTC (Opcional):",backgroundToggleLabel:"Fondo:",colorLabel:"Tono del fondo:",saturationLabel:"Saturación:",customTitlePlaceholder:"Título personalizado (máx. 36 caracteres, opcional)",validLink:"Enlace válido",invalidLink:"Enlace inválido: debe ser https://truckersmp.com/user/[...]",validCompanyLink:"Enlace de empresa válido",invalidCompanyLink:"Enlace inválido: debe ser https://truckersmp.com/vtc/[...]",downloadButton:"Descargar Licencia",canvasName:"Nombre :",canvasLicenseNo:"Núm. Licencia :",canvasLevel:"Generación :",canvasDate:"Fecha :",canvasCountry:"País :",canvasTag:"TAG :",levelFormat:"{0}{1}",titleNormal:"PERMISO DE CONDUCCIÓN INTERNACIONAL",titleComedic:"PERMISO PARA CHOCAR EN CONVOY",countryPlaceholder:"Seleccione un país",tooltipMessage:"Esta licencia es una broma y un guiño a la comunidad, no pretende ser algo profesional.",infoTooltip:"Significado de los elementos:\n- Generaciones: TruckersMP comenzó en 2013 y las VTCs en 2019. Las generaciones se calculan aproximando el año de registro del perfil y la VTC.\n- Estrella dorada (✵) junto al nombre: Indica que el usuario es dueño de una VTC. Se puede solicitar abriendo un ticket en el Discord de LAG'S SPEED.\n- Estrellas plateadas (★) a la derecha: Un guiño a la extinta VTC Convoy Nocturno.\n- Símbolo (✓) junto a la fecha: Indica que la fecha proviene de una fuente en línea confiable. Refresca la página para intentar obtener la fecha en línea nuevamente.\n- Símbolo (✗) junto a la fecha: Indica que la fecha es local, no verificada. Refresca la página para intentar obtener la fecha en línea nuevamente.\n- Un verso nocturno susurra un secreto, ¿qué palabra desata el camino oculto?"},en:{pageTitle:"Convoyrama | Driver License Generator",headerTitle:"Driver License Generator",navLicense:"License",nameLabel:"Name:",nicknameLabel:"Epic TAG:",titleToggleLabel:"Use comedic title:",photoLabel:"Photo (Optional):",countryLabel:"Country:",companyLinkLabel:"TruckersMP Company Profile Link:",truckersmpLinkLabel:"TruckersMP Profile Link:",customTitleLabel:"Change title:",watermarkToggleLabel:"Use watermark:",qrColorToggleLabel:"QR Color: Dark / Light",vtcLogoLabel:"VTC Logo (Optional):",backgroundToggleLabel:"Background:",colorLabel:"Background hue:",saturationLabel:"Saturation:",customTitlePlaceholder:"Custom title (max 36 characters, optional)",validLink:"Valid link",invalidLink:"Invalid link: must be https://truckersmp.com/user/[...]",validCompanyLink:"Valid company link",invalidCompanyLink:"Invalid link: must be https://truckersmp.com/vtc/[...]",downloadButton:"Download License",canvasName:"Name :",canvasLicenseNo:"License No. :",canvasLevel:"Generation :",canvasDate:"Date :",canvasCountry:"Country :",canvasTag:"TAG :",levelFormat:"{0}{1}",titleNormal:"INTERNATIONAL DRIVING LICENSE",titleComedic:"CONVOY CRASHING PERMIT",countryPlaceholder:"Select a country",tooltipMessage:"This license is a joke and a nod to the community, not intended to be professional.",infoTooltip:"Meaning of elements:\n- Generations: TruckersMP started in 2013 and VTCs in 2019. Generations are calculated by approximating the profile and VTC registration year.\n- Gold star (✵) next to name: Indicates the user is a VTC owner. It can be requested by opening a ticket in the LAG'S SPEED Discord.\n- Silver stars (★) on the right: A nod to the extinct VTC Convoy Nocturno.\n- Checkmark (✓) next to date: Indicates the date is from a reliable online source. Refresh the page to try fetching the date online again.\n- Cross (✗) next to date: Indicates the date is local, not verified. Refresh the page to try fetching the date online again.\n- A nocturnal verse whispers a secret, what word unlocks the hidden path?"},pt:{pageTitle:"Convoyrama | Gerador de Licença",headerTitle:"Gerador de Licença de Motorista",navLicense:"Licença",nameLabel:"Nome:",nicknameLabel:"TAG Épico:",titleToggleLabel:"Usar título cômico:",photoLabel:"Foto (Opcional):",countryLabel:"País:",companyLinkLabel:"Link do Perfil da Empresa no TruckersMP:",truckersmpLinkLabel:"Link do Perfil no TruckersMP:",customTitleLabel:"Alterar título:",watermarkToggleLabel:"Usar marca d'água:",qrColorToggleLabel:"Cor do QR: Escuro / Claro",vtcLogoLabel:"Logo VTC (Opcional):",backgroundToggleLabel:"Fundo:",colorLabel:"Tom do fundo:",saturationLabel:"Saturação:",customTitlePlaceholder:"Título personalizado (máx. 36 caracteres, opcional)",validLink:"Link válido",invalidLink:"Link inválido: deve ser https://truckersmp.com/user/[...]",validCompanyLink:"Link de empresa válido",invalidCompanyLink:"Link inválido: deve ser https://truckersmp.com/vtc/[...]",downloadButton:"Baixar Licença",canvasName:"Nome :",canvasLicenseNo:"Núm. Licença :",canvasLevel:"Geração :",canvasDate:"Data :",canvasCountry:"País :",canvasTag:"TAG :",levelFormat:"{0}{1}",titleNormal:"LICENÇA INTERNACIONAL DE CONDUÇÃO",titleComedic:"PERMISSÃO PARA CAUSAR CAOS EM COMBOIO",countryPlaceholder:"Selecione um país",tooltipMessage:"Esta licença é uma brincadeira e uma homenagem à comunidade, não pretende ser profissional.",infoTooltip:"Significado dos elementos:\n- Gerações: TruckersMP começou em 2013 e as VTCs em 2019. As gerações são calculadas aproximando o ano de registro do perfil e da VTC.\n- Estrela dourada (✵) ao lado do nome: Indica que o usuário é dono de uma VTC. Pode ser solicitada abrindo um ticket no Discord do LAG'S SPEED.\n- Estrelas prateadas (★) à direita: Uma homenagem à extinta VTC Convoy Nocturno.\n- Marca de verificação (✓) ao lado da data: Indica que a data vem de uma fonte online confiável. Atualize a página para tentar obter a data online novamente.\n- Cruz (✗) ao lado da data: Indica que a data é local, não verificada. Atualize a página para tentar obter a data online novamente.\n- Um verso noturno sussurra um segredo, que palavra desvenda o caminho oculto?"}};const nameInput=document.getElementById("nombre"),photoInput=document.getElementById("foto"),vtcLogoInput=document.getElementById("vtcLogo"),countrySelect=document.getElementById("pais"),nicknameSelect=document.getElementById("nickname"),companyLinkInput=document.getElementById("empresaLink"),truckersmpLinkInput=document.getElementById("truckersmpLink"),truckersmpStatus=document.getElementById("truckersmpStatus"),companyLinkStatus=document.getElementById("empresaLinkStatus"),nicknameGroup=document.getElementById("nicknameGroup"),titleToggleGroup=document.getElementById("titleToggleGroup"),titleToggleInput=document.getElementById("titleToggle"),promodsToggleInput=document.getElementById("promodsToggle"),dbusworldToggleInput=document.getElementById("dbusworldToggle"),watermarkToggleInput=document.getElementById("watermarkToggle"),qrColorToggleInput=document.getElementById("qrColorToggle"),backgroundSelect=document.getElementById("backgroundSelect"),languageSelect=document.getElementById("languageToggle"),colorSlider=document.getElementById("colorSlider"),colorValue=document.getElementById("colorValue"),saturationSlider=document.getElementById("saturationSlider"),saturationValue=document.getElementById("saturationValue"),downloadButton=document.getElementById("botonDescargar"),infoButton=document.getElementById("infoButton"),customTitleInput=document.getElementById("customTitle");let userImage=null,vtcLogoImage=null,isNicknameUnlocked=localStorage.getItem("nicknameUnlocked")==="true",currentDate=null,lastDateFetch=0,isDateFromInternet=false,vtcData={vtcOwners:[],starMap:{}},countries=[];const DATE_CACHE_DURATION=360000;let currentLanguage="es",lastFormState={};const userLevelRanges=[{year:2013,maxId:3e5,level:1},{year:2014,maxId:6e5,level:2},{year:2015,maxId:1e6,level:3},{year:2016,maxId:14e5,level:4},{year:2017,maxId:18e5,level:5},{year:2018,maxId:22e5,level:6},{year:2019,maxId:26e5,level:7},{year:2020,maxId:3e6,level:8},{year:2021,maxId:34e5,level:9},{year:2022,maxId:38e5,level:10},{year:2023,maxId:42e5,level:11},{year:2024,maxId:46e5,level:12},{year:2025,maxId:5e6,level:13},{year:2026,maxId:54e5,level:14},{year:2027,maxId:58e5,level:15},{year:2028,maxId:62e5,level:16},{year:2029,maxId:66e5,level:17},{year:2030,maxId:7e6,level:18},{year:2031,maxId:74e5,level:19},{year:2032,maxId:78e5,level:20},{year:2033,maxId:82e5,level:21},{year:2034,maxId:86e5,level:22},{year:2035,maxId:9e6,level:23},{year:2036,maxId:94e5,level:24},{year:2037,maxId:98e5,level:25},{year:2038,maxId:102e5,level:26},{year:2039,maxId:106e5,level:27},{year:2040,maxId:11e6,level:28},{year:2041,maxId:114e5,level:29},{year:2042,maxId:118e5,level:30},{year:2043,maxId:122e5,level:31},{year:2044,maxId:126e5,level:32}];const vtcLevelRanges=[{year:2019,maxId:100,level:1},{year:2020,maxId:13000,level:2},{year:2021,maxId:26000,level:3},{year:2022,maxId:39000,level:4},{year:2023,maxId:52000,level:5},{year:2024,maxId:65000,level:6},{year:2025,maxId:78865,level:7},{year:2026,maxId:92000,level:8},{year:2027,maxId:105000,level:9},{year:2028,maxId:118000,level:10},{year:2029,maxId:131000,level:11},{year:2030,maxId:144000,level:12},{year:2031,maxId:157000,level:13},{year:2032,maxId:170000,level:14},{year:2033,maxId:183000,level:15},{year:2034,maxId:196000,level:16},{year:2035,maxId:209000,level:17},{year:2036,maxId:222000,level:18},{year:2037,maxId:235000,level:19},{year:2038,maxId:248000,level:20},{year:2039,maxId:261000,level:21},{year:2040,maxId:274000,level:22},{year:2041,maxId:287000,level:23},{year:2042,maxId:300000,level:24},{year:2043,maxId:313000,level:25},{year:2044,maxId:326000,level:26},{year:2045,maxId:339000,level:27}];async function loadVtcData(){try{const response=await fetch('./assets/data/vtcData.json');if(!response.ok)throw new Error('Failed to load vtcData.json');vtcData=await response.json();console.log('vtcData loaded successfully:',vtcData);}catch(error){console.error('Error loading vtcData.json:',error);vtcData={vtcOwners:[],starMap:{}};}}async function loadCountries(){try{const response=await fetch('./assets/data/countries.json');if(!response.ok)throw new Error('Failed to load countries.json');countries=await response.json();console.log('Countries loaded successfully:',countries);return countries;}catch(error){console.error('Error loading countries.json:',error);return [];}}function populateCountries(countries,lang){const trans=translations[lang];const nameIndex={es:"name_es",en:"name_en",pt:"name_pt"}[lang];countrySelect.innerHTML=`<option value="">${trans.countryPlaceholder}</option>`;countries.sort((a,b)=>a[nameIndex].localeCompare(b[nameIndex]));countries.forEach(country=>{const option=document.createElement("option");option.value=`${country.code}|${country.emoji}|${country.name_es}|${country.name_en}|${country.name_pt}`;option.text=`${country.emoji} ${country[nameIndex]}`;countrySelect.appendChild(option);});}function getOrdinalSuffix(number,lang){if(lang==="en"){if(number===1)return"st";if(number===2)return"nd";if(number===3)return"rd";return"th";}return"º";}function getFlagEmoji(countryCode){if(!countryCode||countryCode==="")return null;const codePoints=countryCode.toUpperCase().split("").map(char=>0x1F1E6+char.charCodeAt(0)-65);return String.fromCodePoint(...codePoints);}async function renderTwemoji(emoji,size){return new Promise((resolve,reject)=>{const img=new Image();img.crossOrigin="anonymous";img.onload=()=>{console.log(`Emoji cargado correctamente: ${emoji}`);resolve(img);};img.onerror=()=>{console.error(`Error al cargar emoji: ${emoji}`);resolve(null);};const parsed=twemoji.parse(emoji,{folder:'svg',ext:'.svg'});const src=parsed.match(/src="([^"]+)"/)?.[1]||"";if(!src){console.error(`No se pudo parsear el emoji: ${emoji}`);resolve(null);}else{img.src=src;}});}async function getCurrentDate(){const now=Date.now();if(currentDate&&now-lastDateFetch<DATE_CACHE_DURATION)return currentDate;const apis=[{url:'https://worldtimeapi.org/api/timezone/Etc/UTC',parse:data=>{const date=new Date(data.datetime);return{day:date.getDate().toString().padStart(2,"0"),month:(date.getMonth()+1).toString().padStart(2,"0"),year:date.getFullYear()};}},{url:'https://timeapi.io/api/Time/current/utc',parse:data=>({day:data.day.toString().padStart(2,"0"),month:data.month.toString().padStart(2,"0"),year:data.year})},{url:'https://worldclockapi.herokuapp.com/api/json/utc/now',parse:data=>{const date=new Date(data.currentDateTime);return{day:date.getDate().toString().padStart(2,"0"),month:(date.getMonth()+1).toString().padStart(2,"0"),year:data.getFullYear()};}}];for(const api of apis){try{const response=await fetch(api.url);const data=await response.json();const{day,month,year}=api.parse(data);currentDate=`${day}/${month}/${year}`;lastDateFetch=now;isDateFromInternet=true;return currentDate;}catch(error){}}const date=new Date();currentDate=`${date.getDate().toString().padStart(2,"0")}/${(date.getMonth()+1).toString().padStart(2,"0")}/${date.getFullYear()}`;lastDateFetch=now;isDateFromInternet=false;return currentDate;}function updateLanguage(lang){currentLanguage=lang;const trans=translations[lang];document.getElementById("pageTitle").textContent=trans.pageTitle;document.getElementById("headerTitle").textContent=trans.headerTitle;document.getElementById("navLicense").textContent=trans.navLicense;document.getElementById("nameLabel").textContent=trans.nameLabel;document.getElementById("nicknameLabel").textContent=trans.nicknameLabel;document.getElementById("titleToggleLabel").textContent=trans.titleToggleLabel;document.getElementById("photoLabel").textContent=trans.photoLabel;document.getElementById("countryLabel").textContent=trans.countryLabel;document.getElementById("companyLinkLabel").textContent=trans.companyLinkLabel;document.getElementById("truckersmpLinkLabel").textContent=trans.truckersmpLinkLabel;document.getElementById("customTitleLabel").textContent=trans.customTitleLabel;document.getElementById("watermarkToggleLabel").textContent=trans.watermarkToggleLabel;document.getElementById("qrColorToggleLabel").textContent=trans.qrColorToggleLabel;document.getElementById("vtcLogoLabel").textContent=trans.vtcLogoLabel;document.getElementById("backgroundToggleLabel").textContent=trans.backgroundToggleLabel;document.getElementById("colorLabel").textContent=trans.colorLabel;document.getElementById("saturationLabel").textContent=trans.saturationLabel;document.getElementById("botonDescargar").textContent=trans.downloadButton;document.getElementById("botonDescargar").setAttribute("data-tooltip",trans.tooltipMessage);document.getElementById("infoButton").setAttribute("data-tooltip",trans.infoTooltip);countrySelect.options[0].text=trans.countryPlaceholder;customTitleInput.placeholder=trans.customTitlePlaceholder;const truckersmpLink=truckersmpLinkInput.value.trim(),companyLink=companyLinkInput.value.trim();if(truckersmpLink)validateTruckersmpLink(truckersmpLink);if(companyLink)validateCompanyLink(companyLink);loadCountries().then(countries=>{populateCountries(countries,lang);debouncedGenerateImage();});}function normalizeLink(link){return link.trim().replace(/\/+$/,'').replace(/\?.*$/,'').replace(/(-[a-z0-9-]+)?$/,'').toLowerCase();}function getUserLevel(userId){if(!userId||isNaN(userId))return"N/A";const id=parseInt(userId);for(const range of userLevelRanges){if(id<=range.maxId)return range.level;}const lastRange=userLevelRanges[userLevelRanges.length-1],yearsSinceLast=Math.floor((id-lastRange.maxId)/400000)+1;return lastRange.level+yearsSinceLast;}function getVtcLevel(vtcId){if(!vtcId||isNaN(vtcId))return"N/A";const id=parseInt(vtcId);for(const range of vtcLevelRanges){if(id<=range.maxId)return range.level;}const lastRange=vtcLevelRanges[vtcLevelRanges.length-1],yearsSinceLast=Math.floor((id-lastRange.maxId)/13144)+1;return lastRange.level+yearsSinceLast;}function generateLicenseNumber(name,country,truckersmpLink,companyLink){const countryCode=country.split("|")[0].substring(0,2)||"XX";let userId="",vtcId="";if(truckersmpLink){const match=truckersmpLink.match(/truckersmp\.com\/user\/(\d+)/);userId=match?match[1]:"";}if(companyLink){const match=companyLink.match(/truckersmp\.com\/vtc\/(\d+)/);vtcId=match?match[1]:"";}const userLevel=getUserLevel(userId),vtcLevel=getVtcLevel(vtcId),licenseNumber=userId?`${countryCode}${userId}`:"";return{licenseNumber,userLevel,vtcLevel};}function validateTruckersmpLink(link){const regex=/^https:\/\/truckersmp\.com\/user\/.+$/,trans=translations[currentLanguage];if(!regex.test(link)){truckersmpStatus.textContent=trans.invalidLink;truckersmpStatus.className="invalid";return false;}truckersmpStatus.textContent=trans.validLink;truckersmpStatus.className="valid";return true;}function validateCompanyLink(link){const regex=/^https:\/\/truckersmp\.com\/vtc\/.+$/,trans=translations[currentLanguage];if(!regex.test(link)){companyLinkStatus.textContent=trans.invalidCompanyLink;companyLinkStatus.className="invalid";return false;}companyLinkStatus.textContent=trans.validCompanyLink;companyLinkStatus.className="valid";return true;}function saveDefaultCountry(){localStorage.setItem("defaultCountry",countrySelect.value);}function loadDefaultCountry(){const savedCountry=localStorage.getItem("defaultCountry");if(savedCountry)countrySelect.value=savedCountry;}function updateForm(){const name=nameInput.value.toLowerCase().trim();if(name==="resetnick"){isNicknameUnlocked=false;localStorage.removeItem("nicknameUnlocked");}else if(["nocturno","verso nocturno","versonocturno"].includes(name)){isNicknameUnlocked=true;localStorage.setItem("nicknameUnlocked","true");}nicknameGroup.classList.toggle("hidden",!isNicknameUnlocked);titleToggleGroup.classList.toggle("hidden",!isNicknameUnlocked);const companyLink=companyLinkInput.value.trim();if(companyLink)validateCompanyLink(companyLink);debouncedGenerateImage();}function getFormState(){return{name:nameInput.value,country:countrySelect.value,nickname:nicknameSelect.value,truckersmpLink:truckersmpLinkInput.value,companyLink:companyLinkInput.value,titleToggle:titleToggleInput.checked,promodsToggle:promodsToggleInput.checked,dbusworldToggle:dbusworldToggleInput.checked,watermarkToggle:watermarkToggleInput.checked,qrColorToggle:qrColorToggleInput.checked,backgroundTemplate:backgroundSelect.value,language:currentLanguage,colorHue:colorSlider.value,saturation:saturationSlider.value,customTitle:customTitleInput.value};}function resizeCanvas(){const isMobile=window.innerWidth<768;const canvasContainer=document.querySelector('.canvas-container');const containerWidth=canvasContainer.clientWidth;canvas.width=config.baseWidth;canvas.height=config.baseHeight;if(isMobile){canvas.style.width=`${Math.min(containerWidth,800)}px`;canvas.style.height=`${Math.min(containerWidth,800)/1.6}px`;}else{canvas.style.width='400px';canvas.style.height='250px';}}async function generateImage(){resizeCanvas();const scaleFactor=canvas.width/config.baseWidth;const formState=getFormState();lastFormState=formState;const trans=translations[currentLanguage],nameIndex={es:2,en:3,pt:4}[currentLanguage],name=nameInput.value||(currentLanguage==="es"?"Sin nombre":currentLanguage==="en"?"No name":"Sem nome"),countryData=countrySelect.value.split("|"),countryCode=countryData[0]||"XX",flagEmoji=countryData[1]||"",countryName=countryData[nameIndex]||(currentLanguage==="es"?"Sin país":currentLanguage==="en"?"No country":"Sem país"),nickname=nicknameSelect.value||"",truckersmpLink=truckersmpLinkInput.value.trim(),normalizedTruckersmpLink=normalizeLink(truckersmpLink),companyLink=companyLinkInput.value.trim(),normalizedCompanyLink=normalizeLink(companyLink),isTruckersmpValid=truckersmpLink?validateTruckersmpLink(truckersmpLink):false,isCompanyValid=companyLink?validateCompanyLink(companyLink):false,hueRotate=parseInt(colorSlider.value),saturation=parseInt(saturationSlider.value),backgroundImage=formState.backgroundTemplate;ctx.imageSmoothingEnabled=true;ctx.imageSmoothingQuality="high";ctx.save();ctx.clearRect(0,0,canvas.width,canvas.height);ctx.font=null;ctx.fillStyle=null;ctx.textAlign="start";ctx.textBaseline="alphabetic";ctx.shadowColor="transparent";ctx.globalCompositeOperation="source-over";const templateImage=new Image();templateImage.src=`./assets/images/${backgroundImage}`;console.log(`Loading template: ${templateImage.src}`);const languageImageSrc={es:'./assets/images/es.png',en:'./assets/images/en.png',pt:'./assets/images/pt.png'}[currentLanguage],languageImage=new Image();languageImage.src=languageImageSrc;const[templateImg,languageImg,defaultPhoto,promodsImg,dbusworldImg]=await Promise.all([new Promise(resolve=>{templateImage.onload=()=>{console.log(`Template loaded: ${backgroundImage}`);resolve(templateImage);};templateImage.onerror=()=>{console.error(`Failed to load template: ${backgroundImage}`);resolve(null);};}),new Promise(resolve=>{languageImage.onload=()=>resolve(languageImage);languageImage.onerror=()=>resolve(null);}),userImage?Promise.resolve(null):renderTwemoji("👤",config.defaultPhotoSize*scaleFactor),promodsToggleInput.checked?new Promise(resolve=>{const img=new Image();img.src="./assets/images/promods.png";img.onload=()=>resolve(img);img.onerror=()=>resolve(null);}):Promise.resolve(null),dbusworldToggleInput.checked?new Promise(resolve=>{const img=new Image();img.src="./assets/images/dbusworld.png";img.onload=()=>resolve(img);img.onerror=()=>resolve(null);}):Promise.resolve(null)]);if(templateImg){ctx.filter=`hue-rotate(${hueRotate}deg) saturate(${saturation}%)`;ctx.drawImage(templateImg,0,0,canvas.width,canvas.height);ctx.filter="none";}else{ctx.fillStyle="#fff";ctx.fillRect(0,0,canvas.width,canvas.height);console.log("Using fallback white background");}if(languageImg)ctx.drawImage(languageImg,0,0,canvas.width,canvas.height);ctx.font=`bold ${config.titleFontSize*scaleFactor}px 'Verdana-Bold'`;ctx.fillStyle="#fff";ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText(customTitleInput.value.trim()||"TRUCKERSMP",canvas.width/2,40.77*scaleFactor);if(userImage){ctx.drawImage(userImage,config.photoX*scaleFactor,config.photoY*scaleFactor,config.defaultPhotoSize*scaleFactor,config.defaultPhotoSize*scaleFactor);}else if(defaultPhoto){ctx.drawImage(defaultPhoto,config.photoX*scaleFactor,config.photoY*scaleFactor,config.defaultPhotoSize*scaleFactor,config.defaultPhotoSize*scaleFactor);}if(vtcLogoImage){const vtcLogoX=(config.qrX-2*config.qrSize-2*config.qrSpacing)*scaleFactor;ctx.drawImage(vtcLogoImage,vtcLogoX,config.qrY*scaleFactor,config.vtcLogoSize*scaleFactor,config.vtcLogoSize*scaleFactor);}const currentDateStr=await getCurrentDate();ctx.font=`bold ${config.textFontSize*scaleFactor}px ${config.font}`;ctx.fillStyle=config.color;ctx.textAlign="left";ctx.textBaseline="alphabetic";ctx.fillText(trans.canvasName,config.labelX*scaleFactor,config.textY*scaleFactor);ctx.fillText(trans.canvasLicenseNo,config.labelX*scaleFactor,(config.textY+config.lineHeight)*scaleFactor);ctx.fillText(trans.canvasLevel,config.labelX*scaleFactor,(config.textY+config.lineHeight*2)*scaleFactor);ctx.fillText(trans.canvasDate,config.labelX*scaleFactor,(config.textY+config.lineHeight*3)*scaleFactor);ctx.fillText(trans.canvasCountry,config.labelX*scaleFactor,(config.textY+config.lineHeight*4)*scaleFactor);if(isNicknameUnlocked&&nickname)ctx.fillText(trans.canvasTag,config.labelX*scaleFactor,(config.textY+config.lineHeight*5)*scaleFactor);const hasGoldStar=vtcData.vtcOwners.some(owner=>normalizeLink(owner.profileLink)===normalizedTruckersmpLink&&owner.companyLink&&normalizeLink(owner.companyLink)===normalizedCompanyLink);ctx.fillStyle=config.color;ctx.fillText(name,config.textX*scaleFactor,config.textY*scaleFactor);if(hasGoldStar&&isTruckersmpValid&&isCompanyValid){ctx.fillStyle="#FFD700";const nameWidth=ctx.measureText(name).width;ctx.fillText("✵",(config.textX+nameWidth+5)*scaleFactor,config.textY*scaleFactor);}if(name&&name.trim()!==""&&countrySelect.value&&isTruckersmpValid){const{licenseNumber,userLevel,vtcLevel}=generateLicenseNumber(name,countrySelect.value,normalizedTruckersmpLink,normalizedCompanyLink);if(licenseNumber){ctx.fillStyle=config.color;ctx.fillText(licenseNumber,config.textX*scaleFactor,(config.textY+config.lineHeight)*scaleFactor);const ordinalUser=userLevel!=="N/A"?`${userLevel}${getOrdinalSuffix(userLevel,currentLanguage)}`:"N/A",vtcPart=isCompanyValid&&vtcLevel!=="N/A"?` - VTC: ${vtcLevel}${getOrdinalSuffix(vtcLevel,currentLanguage)}`:"";ctx.fillText(trans.levelFormat.replace("{0}",ordinalUser).replace("{1}",vtcPart),config.textX*scaleFactor,(config.textY+config.lineHeight*2)*scaleFactor);}}ctx.fillStyle=config.color;ctx.fillText(currentDateStr,config.textX*scaleFactor,(config.textY+config.lineHeight*3)*scaleFactor);ctx.fillText(isDateFromInternet?"✓":"✗",(config.textX+ctx.measureText(currentDateStr).width+5)*scaleFactor,(config.textY+config.lineHeight*3)*scaleFactor);ctx.fillStyle=config.color;ctx.fillText(countryName,config.textX*scaleFactor,(config.textY+config.lineHeight*4)*scaleFactor);if(isNicknameUnlocked&&nickname){ctx.fillStyle=config.color;ctx.fillText(nickname,config.textX*scaleFactor,(config.textY+config.lineHeight*5)*scaleFactor);}if(promodsImg&&promodsToggleInput.checked){ctx.drawImage(promodsImg,config.promodsX*scaleFactor,config.promodsY*scaleFactor,config.logoWidth*scaleFactor,config.logoHeight*scaleFactor);}if(dbusworldImg&&dbusworldToggleInput.checked){const dbusworldY=promodsToggleInput.checked?config.dbusworldY:config.promodsY;ctx.drawImage(dbusworldImg,config.dbusworldX*scaleFactor,dbusworldY*scaleFactor,config.logoWidth*scaleFactor,config.logoHeight*scaleFactor);}const starConfig=vtcData.starMap[normalizedTruckersmpLink]||{silver:0},silverStarCount=starConfig.silver||0;if(silverStarCount>0&&isTruckersmpValid){ctx.font=`bold ${config.textFontSize*scaleFactor}px ${config.font}`;ctx.textAlign="right";const starX=(config.baseWidth-20)*scaleFactor;let currentY=config.promodsY*scaleFactor;ctx.fillStyle="#C0C0C0";for(let i=0;i<silverStarCount;i++){ctx.fillText("★",starX,currentY);currentY+=config.textFontSize*scaleFactor;}ctx.textAlign="left";}const titleText=isNicknameUnlocked&&titleToggleInput.checked?trans.titleComedic:trans.titleNormal,titleY=(config.baseHeight-5)*scaleFactor;ctx.font=`bold ${config.footerFontSize*scaleFactor}px ${config.font}`;ctx.fillStyle="rgb(240,240,240)";ctx.textAlign="center";ctx.textBaseline="bottom";ctx.shadowColor="rgb(0,0,0)";ctx.shadowOffsetX=1*scaleFactor;ctx.shadowOffsetY=1*scaleFactor;ctx.shadowBlur=2*scaleFactor;ctx.fillText(titleText,canvas.width/2,titleY);ctx.shadowColor="transparent";const qrColor=qrColorToggleInput.checked?"#F0F0F0":"#141414",generateUniformQR=async(value,x,y)=>{return new Promise(resolve=>{try{const qr=new QRCode({content:value,width:config.qrSize*scaleFactor,height:config.qrSize*scaleFactor,color:qrColor,background:"transparent",ecl:"M",padding:0}),svgString=qr.svg(),img=new Image();img.src='data:image/svg+xml;base64,'+btoa(svgString);img.onload=()=>{ctx.save();ctx.setTransform(1,0,0,1,0,0);ctx.globalAlpha=1;ctx.filter="none";ctx.drawImage(img,x*scaleFactor,y*scaleFactor,config.qrSize*scaleFactor,config.qrSize*scaleFactor);ctx.restore();resolve();};img.onerror=()=>{console.error(`Error loading QR SVG for ${value}`);resolve();};}catch(error){console.error(`Error generating QR for ${value}:`,error);resolve();}});};if(isTruckersmpValid){await generateUniformQR(normalizedTruckersmpLink,config.qrX,config.qrY);}if(isCompanyValid){await generateUniformQR(normalizedCompanyLink,config.qrX-config.qrSize-config.qrSpacing,config.qrY);}await generateUniformQR("https://convoyrama.github.io/pages/id.html",config.qrX+config.qrSize+config.qrSpacing,config.qrY);if(vtcLogoImage&&watermarkToggleInput.checked){const centerX=((config.baseWidth-config.watermarkWidth)/2+150)*scaleFactor,centerY=((config.baseHeight-config.watermarkHeight)/2+100)*scaleFactor;ctx.globalAlpha=0.1;ctx.drawImage(vtcLogoImage,centerX,centerY,config.watermarkWidth*scaleFactor,config.watermarkHeight*scaleFactor);ctx.globalAlpha=1;}const flagImg=flagEmoji?await renderTwemoji(flagEmoji,config.flagSize*scaleFactor):null;if(flagImg){ctx.drawImage(flagImg,config.flagX*scaleFactor,config.flagY*scaleFactor,config.flagSize*scaleFactor,config.flagSize*scaleFactor);}ctx.restore();updateDownloadLink();}function updateDownloadLink(){const downloadLink=document.getElementById("descargar"),name=nameInput.value||"unknown";try{downloadLink.href=canvas.toDataURL("image/png");downloadLink.download=`driver_license_${name}.png`;}catch(error){downloadLink.href="#";downloadLink.download="";console.error("Error in toDataURL:",error);}}photoInput.addEventListener("change",event=>{const file=event.target.files[0];if(file){const reader=new FileReader();reader.onload=ev=>{userImage=new Image();userImage.src=ev.target.result;userImage.crossOrigin="anonymous";userImage.onload=()=>{console.log("Foto de perfil cargada, actualizando canvas...");debouncedGenerateImage();};userImage.onerror=()=>{console.error("Error al cargar la foto de perfil");userImage=null;debouncedGenerateImage();};};reader.readAsDataURL(file);}else{userImage=null;console.log("Foto de perfil eliminada, actualizando canvas...");debouncedGenerateImage();}});vtcLogoInput.addEventListener("change",event=>{const file=event.target.files[0];if(file){const reader=new FileReader();reader.onload=ev=>{vtcLogoImage=new Image();vtcLogoImage.src=ev.target.result;vtcLogoImage.crossOrigin="anonymous";vtcLogoImage.onload=()=>{console.log("Logo VTC cargado, actualizando canvas...");debouncedGenerateImage();};vtcLogoImage.onerror=()=>{console.error("Error al cargar el logo VTC");vtcLogoImage=null;debouncedGenerateImage();};};reader.readAsDataURL(file);}else{vtcLogoImage=null;console.log("Logo VTC eliminado, actualizando canvas...");debouncedGenerateImage();}});promodsToggleInput.addEventListener("change",()=>{console.log("Toggle ProMods cambiado, actualizando canvas...");debouncedGenerateImage();});dbusworldToggleInput.addEventListener("change",()=>{console.log("Toggle DBusWorld cambiado, actualizando canvas...");debouncedGenerateImage();});truckersmpLinkInput.addEventListener("input",()=>{const link=truckersmpLinkInput.value.trim();if(link){validateTruckersmpLink(link);}else{truckersmpStatus.textContent="";truckersmpStatus.className="";}debouncedGenerateImage();});companyLinkInput.addEventListener("input",()=>{const link=companyLinkInput.value.trim();if(link){validateCompanyLink(link);}else{companyLinkStatus.textContent="";companyLinkStatus.className="";}debouncedGenerateImage();});languageSelect.addEventListener("change",()=>updateLanguage(languageSelect.value));colorSlider.addEventListener("input",()=>{colorValue.textContent=`${colorSlider.value}°`;debouncedGenerateImage();});saturationSlider.addEventListener("input",()=>{saturationValue.textContent=`${saturationSlider.value}%`;debouncedGenerateImage();});watermarkToggleInput.addEventListener("change",debouncedGenerateImage);qrColorToggleInput.addEventListener("change",debouncedGenerateImage);backgroundSelect.addEventListener("change",()=>{console.log(`Background template changed to: ${backgroundSelect.value}`);debouncedGenerateImage();});nameInput.addEventListener("input",updateForm);countrySelect.addEventListener("change",()=>{saveDefaultCountry();debouncedGenerateImage();});nicknameSelect.addEventListener("change",debouncedGenerateImage);titleToggleInput.addEventListener("change",debouncedGenerateImage);customTitleInput.addEventListener("input",debouncedGenerateImage);window.addEventListener("resize",debouncedGenerateImage);async function init(){await loadVtcData();await loadCountries();loadDefaultCountry();updateForm();updateLanguage(currentLanguage);debouncedGenerateImage();}init();</script></body></html>
